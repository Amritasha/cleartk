<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
<title>Source code</title>
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
</head>
<body>
<div class="sourceContainer">
<pre><span class="sourceLineNo">001</span>/** <a name="line.1"></a>
<span class="sourceLineNo">002</span> * Copyright (c) 2010, Regents of the University of Colorado <a name="line.2"></a>
<span class="sourceLineNo">003</span> * All rights reserved.<a name="line.3"></a>
<span class="sourceLineNo">004</span> * <a name="line.4"></a>
<span class="sourceLineNo">005</span> * Redistribution and use in source and binary forms, with or without<a name="line.5"></a>
<span class="sourceLineNo">006</span> * modification, are permitted provided that the following conditions are met:<a name="line.6"></a>
<span class="sourceLineNo">007</span> * <a name="line.7"></a>
<span class="sourceLineNo">008</span> * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer. <a name="line.8"></a>
<span class="sourceLineNo">009</span> * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution. <a name="line.9"></a>
<span class="sourceLineNo">010</span> * Neither the name of the University of Colorado at Boulder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission. <a name="line.10"></a>
<span class="sourceLineNo">011</span> * <a name="line.11"></a>
<span class="sourceLineNo">012</span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"<a name="line.12"></a>
<span class="sourceLineNo">013</span> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE<a name="line.13"></a>
<span class="sourceLineNo">014</span> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE<a name="line.14"></a>
<span class="sourceLineNo">015</span> * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE<a name="line.15"></a>
<span class="sourceLineNo">016</span> * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR<a name="line.16"></a>
<span class="sourceLineNo">017</span> * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF<a name="line.17"></a>
<span class="sourceLineNo">018</span> * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS<a name="line.18"></a>
<span class="sourceLineNo">019</span> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN<a name="line.19"></a>
<span class="sourceLineNo">020</span> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)<a name="line.20"></a>
<span class="sourceLineNo">021</span> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE<a name="line.21"></a>
<span class="sourceLineNo">022</span> * POSSIBILITY OF SUCH DAMAGE. <a name="line.22"></a>
<span class="sourceLineNo">023</span> */<a name="line.23"></a>
<span class="sourceLineNo">024</span>package org.cleartk.test.util;<a name="line.24"></a>
<span class="sourceLineNo">025</span><a name="line.25"></a>
<span class="sourceLineNo">026</span>import java.io.File;<a name="line.26"></a>
<span class="sourceLineNo">027</span>import java.util.Arrays;<a name="line.27"></a>
<span class="sourceLineNo">028</span>import java.util.HashSet;<a name="line.28"></a>
<span class="sourceLineNo">029</span>import java.util.Set;<a name="line.29"></a>
<span class="sourceLineNo">030</span>import java.util.logging.Logger;<a name="line.30"></a>
<span class="sourceLineNo">031</span><a name="line.31"></a>
<span class="sourceLineNo">032</span>import org.apache.uima.fit.factory.JCasFactory;<a name="line.32"></a>
<span class="sourceLineNo">033</span>import org.apache.uima.jcas.JCas;<a name="line.33"></a>
<span class="sourceLineNo">034</span>import org.junit.Assume;<a name="line.34"></a>
<span class="sourceLineNo">035</span>import org.junit.Before;<a name="line.35"></a>
<span class="sourceLineNo">036</span>import org.junit.Rule;<a name="line.36"></a>
<span class="sourceLineNo">037</span>import org.junit.rules.TemporaryFolder;<a name="line.37"></a>
<span class="sourceLineNo">038</span><a name="line.38"></a>
<span class="sourceLineNo">039</span>/**<a name="line.39"></a>
<span class="sourceLineNo">040</span> * &lt;br&gt;<a name="line.40"></a>
<span class="sourceLineNo">041</span> * Copyright (c) 2010, Regents of the University of Colorado &lt;br&gt;<a name="line.41"></a>
<span class="sourceLineNo">042</span> * All rights reserved.<a name="line.42"></a>
<span class="sourceLineNo">043</span> * <a name="line.43"></a>
<span class="sourceLineNo">044</span> * @author Philip Ogren<a name="line.44"></a>
<span class="sourceLineNo">045</span> */<a name="line.45"></a>
<span class="sourceLineNo">046</span><a name="line.46"></a>
<span class="sourceLineNo">047</span>public abstract class CleartkTestBase {<a name="line.47"></a>
<span class="sourceLineNo">048</span><a name="line.48"></a>
<span class="sourceLineNo">049</span>  /**<a name="line.49"></a>
<span class="sourceLineNo">050</span>   * A {@link Logger} instance associated with the class, intended for use by subclasses.<a name="line.50"></a>
<span class="sourceLineNo">051</span>   */<a name="line.51"></a>
<span class="sourceLineNo">052</span>  protected Logger logger;<a name="line.52"></a>
<span class="sourceLineNo">053</span><a name="line.53"></a>
<span class="sourceLineNo">054</span>  /**<a name="line.54"></a>
<span class="sourceLineNo">055</span>   * The set of names for tests that should be disabled.<a name="line.55"></a>
<span class="sourceLineNo">056</span>   */<a name="line.56"></a>
<span class="sourceLineNo">057</span>  private Set&lt;String&gt; skippedTestNames;<a name="line.57"></a>
<span class="sourceLineNo">058</span><a name="line.58"></a>
<span class="sourceLineNo">059</span>  public CleartkTestBase() {<a name="line.59"></a>
<span class="sourceLineNo">060</span>    super();<a name="line.60"></a>
<span class="sourceLineNo">061</span>    this.logger = Logger.getLogger(this.getClass().getName());<a name="line.61"></a>
<span class="sourceLineNo">062</span>    this.skippedTestNames = new HashSet&lt;String&gt;();<a name="line.62"></a>
<span class="sourceLineNo">063</span>    String skipTests = System.getProperty(SKIP_TESTS_PROPERTY);<a name="line.63"></a>
<span class="sourceLineNo">064</span>    if (skipTests != null) {<a name="line.64"></a>
<span class="sourceLineNo">065</span>      this.skippedTestNames.addAll(Arrays.asList(skipTests.split("\\s*[,]\\s*")));<a name="line.65"></a>
<span class="sourceLineNo">066</span>    }<a name="line.66"></a>
<span class="sourceLineNo">067</span>  }<a name="line.67"></a>
<span class="sourceLineNo">068</span><a name="line.68"></a>
<span class="sourceLineNo">069</span>  /**<a name="line.69"></a>
<span class="sourceLineNo">070</span>   * The name of the property that can be set to skip some tests. The property value will be parsed<a name="line.70"></a>
<span class="sourceLineNo">071</span>   * as a comma-separated list of values, where each value can designate one type of test to skip,<a name="line.71"></a>
<span class="sourceLineNo">072</span>   * e.g. {@value #LONG_TESTS_PROPERTY_VALUE} or {@value #BIG_MEMORY_TESTS_PROPERTY_VALUE}. Example<a name="line.72"></a>
<span class="sourceLineNo">073</span>   * usage: &lt;br/&gt;<a name="line.73"></a>
<span class="sourceLineNo">074</span>   * &lt;code&gt;-Dcleartk.skipTests=long,bigMem&lt;/code&gt;<a name="line.74"></a>
<span class="sourceLineNo">075</span>   */<a name="line.75"></a>
<span class="sourceLineNo">076</span>  public static final String SKIP_TESTS_PROPERTY = "cleartk.skipTests";<a name="line.76"></a>
<span class="sourceLineNo">077</span><a name="line.77"></a>
<span class="sourceLineNo">078</span>  /**<a name="line.78"></a>
<span class="sourceLineNo">079</span>   * Value for the {@link #SKIP_TESTS_PROPERTY} property that indicates that commonly skipped tests<a name="line.79"></a>
<span class="sourceLineNo">080</span>   * should be disabled. Currently, this will disable at least {@value #LONG_TESTS_PROPERTY_VALUE}<a name="line.80"></a>
<span class="sourceLineNo">081</span>   * and {@value #BIG_MEMORY_TESTS_PROPERTY_VALUE} tests. It will also typically disable tests that<a name="line.81"></a>
<span class="sourceLineNo">082</span>   * require binaries that are hard to build (e.g. tk-svmlight, crfsuite). Current value:<a name="line.82"></a>
<span class="sourceLineNo">083</span>   * {@value #COMMON_TESTS_PROPERTY_VALUE}.<a name="line.83"></a>
<span class="sourceLineNo">084</span>   */<a name="line.84"></a>
<span class="sourceLineNo">085</span>  public static final String COMMON_TESTS_PROPERTY_VALUE = "common";<a name="line.85"></a>
<span class="sourceLineNo">086</span><a name="line.86"></a>
<span class="sourceLineNo">087</span>  /**<a name="line.87"></a>
<span class="sourceLineNo">088</span>   * Value for the {@link #SKIP_TESTS_PROPERTY} property that indicates that all tests that can be<a name="line.88"></a>
<span class="sourceLineNo">089</span>   * skipped are disabled. Current value: {@value #ALL_TESTS_PROPERTY_VALUE}.<a name="line.89"></a>
<span class="sourceLineNo">090</span>   */<a name="line.90"></a>
<span class="sourceLineNo">091</span>  public static final String ALL_TESTS_PROPERTY_VALUE = "all";<a name="line.91"></a>
<span class="sourceLineNo">092</span><a name="line.92"></a>
<span class="sourceLineNo">093</span>  /**<a name="line.93"></a>
<span class="sourceLineNo">094</span>   * Subclasses should call this method at the beginning of a test to check whether a specific type<a name="line.94"></a>
<span class="sourceLineNo">095</span>   * of test is enabled by checking whether the name of that test is contained in the<a name="line.95"></a>
<span class="sourceLineNo">096</span>   * {@value #SKIP_TESTS_PROPERTY} property. If the name is present, then the test will be skipped.<a name="line.96"></a>
<span class="sourceLineNo">097</span>   * <a name="line.97"></a>
<span class="sourceLineNo">098</span>   * Typically, immediately after calling {@link #assumeTestsEnabled}, a test should log a message<a name="line.98"></a>
<span class="sourceLineNo">099</span>   * created by {@link #createTestEnabledMessage} to explain to a user how to disable the test if<a name="line.99"></a>
<span class="sourceLineNo">100</span>   * they wish.<a name="line.100"></a>
<span class="sourceLineNo">101</span>   * <a name="line.101"></a>
<span class="sourceLineNo">102</span>   * Note that if {@value #SKIP_TESTS_PROPERTY} contains {@value #ALL_TESTS_PROPERTY_VALUE} then the<a name="line.102"></a>
<span class="sourceLineNo">103</span>   * test will be skipped even if {@link #ALL_TESTS_PROPERTY_VALUE} was not passed as an argument to<a name="line.103"></a>
<span class="sourceLineNo">104</span>   * this method.<a name="line.104"></a>
<span class="sourceLineNo">105</span>   */<a name="line.105"></a>
<span class="sourceLineNo">106</span>  protected void assumeTestsEnabled(String... testNames) {<a name="line.106"></a>
<span class="sourceLineNo">107</span>    Assume.assumeTrue(!this.skippedTestNames.contains(ALL_TESTS_PROPERTY_VALUE));<a name="line.107"></a>
<span class="sourceLineNo">108</span>    for (String testName : testNames) {<a name="line.108"></a>
<span class="sourceLineNo">109</span>      Assume.assumeTrue(!this.skippedTestNames.contains(testName));<a name="line.109"></a>
<span class="sourceLineNo">110</span>    }<a name="line.110"></a>
<span class="sourceLineNo">111</span>  }<a name="line.111"></a>
<span class="sourceLineNo">112</span><a name="line.112"></a>
<span class="sourceLineNo">113</span>  /**<a name="line.113"></a>
<span class="sourceLineNo">114</span>   * Subclasses should call this method to create a message that explains how to disable a test.<a name="line.114"></a>
<span class="sourceLineNo">115</span>   * Typically such a message should be logged immediately after calling<a name="line.115"></a>
<span class="sourceLineNo">116</span>   * {@link #assumeTestsEnabled(String...)}.<a name="line.116"></a>
<span class="sourceLineNo">117</span>   * <a name="line.117"></a>
<span class="sourceLineNo">118</span>   * @param testName<a name="line.118"></a>
<span class="sourceLineNo">119</span>   *          The name of the test (i.e. the value that should be present in the<a name="line.119"></a>
<span class="sourceLineNo">120</span>   *          {@value #SKIP_TESTS_PROPERTY} property)<a name="line.120"></a>
<span class="sourceLineNo">121</span>   * @param message<a name="line.121"></a>
<span class="sourceLineNo">122</span>   *          A message describing the requirements of the tests that are run when the named test is<a name="line.122"></a>
<span class="sourceLineNo">123</span>   *          enabled.<a name="line.123"></a>
<span class="sourceLineNo">124</span>   * @return A message that contains both the given description and an explanation of how to disable<a name="line.124"></a>
<span class="sourceLineNo">125</span>   *         the test.<a name="line.125"></a>
<span class="sourceLineNo">126</span>   */<a name="line.126"></a>
<span class="sourceLineNo">127</span>  public static String createTestEnabledMessage(String testName, String message) {<a name="line.127"></a>
<span class="sourceLineNo">128</span>    String format = "%s. To skip this test, set -D%s=%s";<a name="line.128"></a>
<span class="sourceLineNo">129</span>    return String.format(format, message.replaceAll("[.]$", ""), SKIP_TESTS_PROPERTY, testName);<a name="line.129"></a>
<span class="sourceLineNo">130</span>  }<a name="line.130"></a>
<span class="sourceLineNo">131</span><a name="line.131"></a>
<span class="sourceLineNo">132</span>  /**<a name="line.132"></a>
<span class="sourceLineNo">133</span>   * Value for the {@link #SKIP_TESTS_PROPERTY} property that indicates that long-running tests<a name="line.133"></a>
<span class="sourceLineNo">134</span>   * should be disabled. Current value: {@value #LONG_TESTS_PROPERTY_VALUE}.<a name="line.134"></a>
<span class="sourceLineNo">135</span>   */<a name="line.135"></a>
<span class="sourceLineNo">136</span>  public static final String LONG_TESTS_PROPERTY_VALUE = "long";<a name="line.136"></a>
<span class="sourceLineNo">137</span><a name="line.137"></a>
<span class="sourceLineNo">138</span>  /**<a name="line.138"></a>
<span class="sourceLineNo">139</span>   * Subclasses should call this method at the beginning of a test that will take a long time to<a name="line.139"></a>
<span class="sourceLineNo">140</span>   * run. Immediately after calling this method, they should also call<a name="line.140"></a>
<span class="sourceLineNo">141</span>   * &lt;code&gt;this.logger.info({@link #LONG_TEST_MESSAGE})&lt;/code&gt;.<a name="line.141"></a>
<span class="sourceLineNo">142</span>   */<a name="line.142"></a>
<span class="sourceLineNo">143</span>  protected void assumeLongTestsEnabled() {<a name="line.143"></a>
<span class="sourceLineNo">144</span>    // note that we can't log the message here as well, or it the log will display the wrong method<a name="line.144"></a>
<span class="sourceLineNo">145</span>    this.assumeTestsEnabled(COMMON_TESTS_PROPERTY_VALUE, LONG_TESTS_PROPERTY_VALUE);<a name="line.145"></a>
<span class="sourceLineNo">146</span>  }<a name="line.146"></a>
<span class="sourceLineNo">147</span><a name="line.147"></a>
<span class="sourceLineNo">148</span>  /**<a name="line.148"></a>
<span class="sourceLineNo">149</span>   * A message indicating that the current test runs for a long time, and giving instructions how to<a name="line.149"></a>
<span class="sourceLineNo">150</span>   * skip it. Should be logged immediately after calling {@link #assumeLongTestsEnabled()}.<a name="line.150"></a>
<span class="sourceLineNo">151</span>   */<a name="line.151"></a>
<span class="sourceLineNo">152</span>  protected static final String LONG_TEST_MESSAGE = createTestEnabledMessage(<a name="line.152"></a>
<span class="sourceLineNo">153</span>      LONG_TESTS_PROPERTY_VALUE,<a name="line.153"></a>
<span class="sourceLineNo">154</span>      "This test takes a long time to run");<a name="line.154"></a>
<span class="sourceLineNo">155</span><a name="line.155"></a>
<span class="sourceLineNo">156</span>  /**<a name="line.156"></a>
<span class="sourceLineNo">157</span>   * Value for the {@link #SKIP_TESTS_PROPERTY} property that indicates that tests requiring a lot<a name="line.157"></a>
<span class="sourceLineNo">158</span>   * of memory should be disabled. Current value: {@value #BIG_MEMORY_TESTS_PROPERTY_VALUE}.<a name="line.158"></a>
<span class="sourceLineNo">159</span>   */<a name="line.159"></a>
<span class="sourceLineNo">160</span>  public static final String BIG_MEMORY_TESTS_PROPERTY_VALUE = "bigMem";<a name="line.160"></a>
<span class="sourceLineNo">161</span><a name="line.161"></a>
<span class="sourceLineNo">162</span>  /**<a name="line.162"></a>
<span class="sourceLineNo">163</span>   * Subclasses should call this method at the beginning of a test that will take a long time to<a name="line.163"></a>
<span class="sourceLineNo">164</span>   * run. Immediately after calling this method, they should also call<a name="line.164"></a>
<span class="sourceLineNo">165</span>   * &lt;code&gt;this.logger.info({@link #BIG_MEMORY_TEST_MESSAGE})&lt;/code&gt;.<a name="line.165"></a>
<span class="sourceLineNo">166</span>   */<a name="line.166"></a>
<span class="sourceLineNo">167</span>  protected void assumeBigMemoryTestsEnabled() {<a name="line.167"></a>
<span class="sourceLineNo">168</span>    // note that we can't log the message here as well, or it the log will display the wrong method<a name="line.168"></a>
<span class="sourceLineNo">169</span>    this.assumeTestsEnabled(COMMON_TESTS_PROPERTY_VALUE, BIG_MEMORY_TESTS_PROPERTY_VALUE);<a name="line.169"></a>
<span class="sourceLineNo">170</span>  }<a name="line.170"></a>
<span class="sourceLineNo">171</span><a name="line.171"></a>
<span class="sourceLineNo">172</span>  /**<a name="line.172"></a>
<span class="sourceLineNo">173</span>   * A message indicating that the current test requires a lot of memory, and giving instructions<a name="line.173"></a>
<span class="sourceLineNo">174</span>   * how to skip it. Should be logged immediately after calling<a name="line.174"></a>
<span class="sourceLineNo">175</span>   * {@link #assumeBigMemoryTestsEnabled()}.<a name="line.175"></a>
<span class="sourceLineNo">176</span>   */<a name="line.176"></a>
<span class="sourceLineNo">177</span>  public static final String BIG_MEMORY_TEST_MESSAGE = createTestEnabledMessage(<a name="line.177"></a>
<span class="sourceLineNo">178</span>      BIG_MEMORY_TESTS_PROPERTY_VALUE,<a name="line.178"></a>
<span class="sourceLineNo">179</span>      "This test requires a lot of memory");<a name="line.179"></a>
<span class="sourceLineNo">180</span><a name="line.180"></a>
<span class="sourceLineNo">181</span>  protected JCas jCas;<a name="line.181"></a>
<span class="sourceLineNo">182</span><a name="line.182"></a>
<span class="sourceLineNo">183</span>  @Rule<a name="line.183"></a>
<span class="sourceLineNo">184</span>  public TemporaryFolder folder = new TemporaryFolder();<a name="line.184"></a>
<span class="sourceLineNo">185</span><a name="line.185"></a>
<span class="sourceLineNo">186</span>  protected File outputDirectory;<a name="line.186"></a>
<span class="sourceLineNo">187</span><a name="line.187"></a>
<span class="sourceLineNo">188</span>  protected String outputDirectoryName;<a name="line.188"></a>
<span class="sourceLineNo">189</span><a name="line.189"></a>
<span class="sourceLineNo">190</span>  @Before<a name="line.190"></a>
<span class="sourceLineNo">191</span>  public void setUp() throws Exception {<a name="line.191"></a>
<span class="sourceLineNo">192</span>    jCas = JCasFactory.createJCas();<a name="line.192"></a>
<span class="sourceLineNo">193</span>    outputDirectory = folder.newFolder("output");<a name="line.193"></a>
<span class="sourceLineNo">194</span>    outputDirectoryName = outputDirectory.getPath();<a name="line.194"></a>
<span class="sourceLineNo">195</span>  }<a name="line.195"></a>
<span class="sourceLineNo">196</span>}<a name="line.196"></a>




























































</pre>
</div>
</body>
</html>
