<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
<title>Source code</title>
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
</head>
<body>
<div class="sourceContainer">
<pre><span class="sourceLineNo">001</span>/** <a name="line.1"></a>
<span class="sourceLineNo">002</span> * Copyright (c) 2007-2008, Regents of the University of Colorado <a name="line.2"></a>
<span class="sourceLineNo">003</span> * All rights reserved.<a name="line.3"></a>
<span class="sourceLineNo">004</span> * <a name="line.4"></a>
<span class="sourceLineNo">005</span> * Redistribution and use in source and binary forms, with or without<a name="line.5"></a>
<span class="sourceLineNo">006</span> * modification, are permitted provided that the following conditions are met:<a name="line.6"></a>
<span class="sourceLineNo">007</span> * <a name="line.7"></a>
<span class="sourceLineNo">008</span> * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer. <a name="line.8"></a>
<span class="sourceLineNo">009</span> * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution. <a name="line.9"></a>
<span class="sourceLineNo">010</span> * Neither the name of the University of Colorado at Boulder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission. <a name="line.10"></a>
<span class="sourceLineNo">011</span> * <a name="line.11"></a>
<span class="sourceLineNo">012</span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"<a name="line.12"></a>
<span class="sourceLineNo">013</span> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE<a name="line.13"></a>
<span class="sourceLineNo">014</span> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE<a name="line.14"></a>
<span class="sourceLineNo">015</span> * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE<a name="line.15"></a>
<span class="sourceLineNo">016</span> * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR<a name="line.16"></a>
<span class="sourceLineNo">017</span> * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF<a name="line.17"></a>
<span class="sourceLineNo">018</span> * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS<a name="line.18"></a>
<span class="sourceLineNo">019</span> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN<a name="line.19"></a>
<span class="sourceLineNo">020</span> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)<a name="line.20"></a>
<span class="sourceLineNo">021</span> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE<a name="line.21"></a>
<span class="sourceLineNo">022</span> * POSSIBILITY OF SUCH DAMAGE. <a name="line.22"></a>
<span class="sourceLineNo">023</span> */<a name="line.23"></a>
<span class="sourceLineNo">024</span>package org.cleartk.util.cr;<a name="line.24"></a>
<span class="sourceLineNo">025</span><a name="line.25"></a>
<span class="sourceLineNo">026</span>import java.io.File;<a name="line.26"></a>
<span class="sourceLineNo">027</span>import java.io.IOException;<a name="line.27"></a>
<span class="sourceLineNo">028</span>import java.util.ArrayList;<a name="line.28"></a>
<span class="sourceLineNo">029</span>import java.util.Arrays;<a name="line.29"></a>
<span class="sourceLineNo">030</span>import java.util.Iterator;<a name="line.30"></a>
<span class="sourceLineNo">031</span>import java.util.List;<a name="line.31"></a>
<span class="sourceLineNo">032</span>import java.util.regex.Pattern;<a name="line.32"></a>
<span class="sourceLineNo">033</span><a name="line.33"></a>
<span class="sourceLineNo">034</span>import org.apache.commons.io.filefilter.AndFileFilter;<a name="line.34"></a>
<span class="sourceLineNo">035</span>import org.apache.commons.io.filefilter.IOFileFilter;<a name="line.35"></a>
<span class="sourceLineNo">036</span>import org.apache.commons.io.filefilter.NameFileFilter;<a name="line.36"></a>
<span class="sourceLineNo">037</span>import org.apache.commons.io.filefilter.OrFileFilter;<a name="line.37"></a>
<span class="sourceLineNo">038</span>import org.apache.commons.io.filefilter.SuffixFileFilter;<a name="line.38"></a>
<span class="sourceLineNo">039</span>import org.apache.commons.io.filefilter.TrueFileFilter;<a name="line.39"></a>
<span class="sourceLineNo">040</span>import org.apache.uima.UimaContext;<a name="line.40"></a>
<span class="sourceLineNo">041</span>import org.apache.uima.analysis_engine.AnalysisEngineProcessException;<a name="line.41"></a>
<span class="sourceLineNo">042</span>import org.apache.uima.cas.CAS;<a name="line.42"></a>
<span class="sourceLineNo">043</span>import org.apache.uima.collection.CollectionException;<a name="line.43"></a>
<span class="sourceLineNo">044</span>import org.apache.uima.collection.CollectionReader;<a name="line.44"></a>
<span class="sourceLineNo">045</span>import org.apache.uima.collection.CollectionReaderDescription;<a name="line.45"></a>
<span class="sourceLineNo">046</span>import org.apache.uima.fit.component.JCasCollectionReader_ImplBase;<a name="line.46"></a>
<span class="sourceLineNo">047</span>import org.apache.uima.fit.component.ViewCreatorAnnotator;<a name="line.47"></a>
<span class="sourceLineNo">048</span>import org.apache.uima.fit.descriptor.ConfigurationParameter;<a name="line.48"></a>
<span class="sourceLineNo">049</span>import org.apache.uima.fit.descriptor.SofaCapability;<a name="line.49"></a>
<span class="sourceLineNo">050</span>import org.apache.uima.fit.factory.CollectionReaderFactory;<a name="line.50"></a>
<span class="sourceLineNo">051</span>import org.apache.uima.jcas.JCas;<a name="line.51"></a>
<span class="sourceLineNo">052</span>import org.apache.uima.pear.util.FileUtil;<a name="line.52"></a>
<span class="sourceLineNo">053</span>import org.apache.uima.resource.ResourceInitializationException;<a name="line.53"></a>
<span class="sourceLineNo">054</span>import org.apache.uima.util.FileUtils;<a name="line.54"></a>
<span class="sourceLineNo">055</span>import org.apache.uima.util.Progress;<a name="line.55"></a>
<span class="sourceLineNo">056</span>import org.apache.uima.util.ProgressImpl;<a name="line.56"></a>
<span class="sourceLineNo">057</span>import org.cleartk.util.ViewUriUtil;<a name="line.57"></a>
<span class="sourceLineNo">058</span><a name="line.58"></a>
<span class="sourceLineNo">059</span>/**<a name="line.59"></a>
<span class="sourceLineNo">060</span> * &lt;br&gt;<a name="line.60"></a>
<span class="sourceLineNo">061</span> * Copyright (c) 2007-2008, Regents of the University of Colorado &lt;br&gt;<a name="line.61"></a>
<span class="sourceLineNo">062</span> * All rights reserved.<a name="line.62"></a>
<span class="sourceLineNo">063</span> * &lt;p&gt;<a name="line.63"></a>
<span class="sourceLineNo">064</span> * <a name="line.64"></a>
<span class="sourceLineNo">065</span> * A CollectionReader that loads all files in a directory tree.<a name="line.65"></a>
<span class="sourceLineNo">066</span> * <a name="line.66"></a>
<span class="sourceLineNo">067</span> * Files are loaded as plain text and stored in the JCas view selected by the user. ClearTK Document<a name="line.67"></a>
<span class="sourceLineNo">068</span> * objects are added to the same JCas view to record the file IDs and paths.<a name="line.68"></a>
<span class="sourceLineNo">069</span> * <a name="line.69"></a>
<span class="sourceLineNo">070</span> * @author Steven Bethard<a name="line.70"></a>
<span class="sourceLineNo">071</span> * @author Philip Ogren<a name="line.71"></a>
<span class="sourceLineNo">072</span> */<a name="line.72"></a>
<span class="sourceLineNo">073</span>@SofaCapability(outputSofas = ViewUriUtil.URI)<a name="line.73"></a>
<span class="sourceLineNo">074</span>public class FilesCollectionReader extends JCasCollectionReader_ImplBase {<a name="line.74"></a>
<span class="sourceLineNo">075</span><a name="line.75"></a>
<span class="sourceLineNo">076</span>  public static CollectionReaderDescription getDescription(String fileOrDir)<a name="line.76"></a>
<span class="sourceLineNo">077</span>      throws ResourceInitializationException {<a name="line.77"></a>
<span class="sourceLineNo">078</span>    return CollectionReaderFactory.createReaderDescription(<a name="line.78"></a>
<span class="sourceLineNo">079</span>        FilesCollectionReader.class,<a name="line.79"></a>
<span class="sourceLineNo">080</span>        null,<a name="line.80"></a>
<span class="sourceLineNo">081</span>        PARAM_ROOT_FILE,<a name="line.81"></a>
<span class="sourceLineNo">082</span>        fileOrDir);<a name="line.82"></a>
<span class="sourceLineNo">083</span>  }<a name="line.83"></a>
<span class="sourceLineNo">084</span><a name="line.84"></a>
<span class="sourceLineNo">085</span>  public static CollectionReader getCollectionReader(String fileOrDir)<a name="line.85"></a>
<span class="sourceLineNo">086</span>      throws ResourceInitializationException {<a name="line.86"></a>
<span class="sourceLineNo">087</span>    return CollectionReaderFactory.createReader(getDescription(fileOrDir));<a name="line.87"></a>
<span class="sourceLineNo">088</span>  }<a name="line.88"></a>
<span class="sourceLineNo">089</span><a name="line.89"></a>
<span class="sourceLineNo">090</span>  public static CollectionReaderDescription getDescriptionWithView(String dir, String viewName)<a name="line.90"></a>
<span class="sourceLineNo">091</span>      throws ResourceInitializationException {<a name="line.91"></a>
<span class="sourceLineNo">092</span>    return CollectionReaderFactory.createReaderDescription(<a name="line.92"></a>
<span class="sourceLineNo">093</span>        FilesCollectionReader.class,<a name="line.93"></a>
<span class="sourceLineNo">094</span>        PARAM_ROOT_FILE,<a name="line.94"></a>
<span class="sourceLineNo">095</span>        dir,<a name="line.95"></a>
<span class="sourceLineNo">096</span>        PARAM_VIEW_NAME,<a name="line.96"></a>
<span class="sourceLineNo">097</span>        viewName);<a name="line.97"></a>
<span class="sourceLineNo">098</span>  }<a name="line.98"></a>
<span class="sourceLineNo">099</span><a name="line.99"></a>
<span class="sourceLineNo">100</span>  public static CollectionReader getCollectionReaderWithView(String dir, String viewName)<a name="line.100"></a>
<span class="sourceLineNo">101</span>      throws ResourceInitializationException {<a name="line.101"></a>
<span class="sourceLineNo">102</span>    return CollectionReaderFactory.createReader(getDescriptionWithView(dir, viewName));<a name="line.102"></a>
<span class="sourceLineNo">103</span>  }<a name="line.103"></a>
<span class="sourceLineNo">104</span><a name="line.104"></a>
<span class="sourceLineNo">105</span>  public static CollectionReaderDescription getDescriptionWithPatterns(<a name="line.105"></a>
<span class="sourceLineNo">106</span>      String dir,<a name="line.106"></a>
<span class="sourceLineNo">107</span>      String viewName,<a name="line.107"></a>
<span class="sourceLineNo">108</span>      String... patterns) throws ResourceInitializationException {<a name="line.108"></a>
<span class="sourceLineNo">109</span>    return CollectionReaderFactory.createReaderDescription(<a name="line.109"></a>
<span class="sourceLineNo">110</span>        FilesCollectionReader.class,<a name="line.110"></a>
<span class="sourceLineNo">111</span>        PARAM_ROOT_FILE,<a name="line.111"></a>
<span class="sourceLineNo">112</span>        dir,<a name="line.112"></a>
<span class="sourceLineNo">113</span>        PARAM_VIEW_NAME,<a name="line.113"></a>
<span class="sourceLineNo">114</span>        viewName,<a name="line.114"></a>
<span class="sourceLineNo">115</span>        PARAM_PATTERNS,<a name="line.115"></a>
<span class="sourceLineNo">116</span>        patterns);<a name="line.116"></a>
<span class="sourceLineNo">117</span>  }<a name="line.117"></a>
<span class="sourceLineNo">118</span><a name="line.118"></a>
<span class="sourceLineNo">119</span>  public static CollectionReader getCollectionReaderWithPatterns(<a name="line.119"></a>
<span class="sourceLineNo">120</span>      String dir,<a name="line.120"></a>
<span class="sourceLineNo">121</span>      String viewName,<a name="line.121"></a>
<span class="sourceLineNo">122</span>      String... patterns) throws ResourceInitializationException {<a name="line.122"></a>
<span class="sourceLineNo">123</span>    return CollectionReaderFactory.createReader(getDescriptionWithPatterns(dir, viewName, patterns));<a name="line.123"></a>
<span class="sourceLineNo">124</span>  }<a name="line.124"></a>
<span class="sourceLineNo">125</span><a name="line.125"></a>
<span class="sourceLineNo">126</span>  public static CollectionReaderDescription getDescriptionWithSuffixes(<a name="line.126"></a>
<span class="sourceLineNo">127</span>      String dir,<a name="line.127"></a>
<span class="sourceLineNo">128</span>      String viewName,<a name="line.128"></a>
<span class="sourceLineNo">129</span>      String... suffixes) throws ResourceInitializationException {<a name="line.129"></a>
<span class="sourceLineNo">130</span>    return CollectionReaderFactory.createReaderDescription(<a name="line.130"></a>
<span class="sourceLineNo">131</span>        FilesCollectionReader.class,<a name="line.131"></a>
<span class="sourceLineNo">132</span>        PARAM_ROOT_FILE,<a name="line.132"></a>
<span class="sourceLineNo">133</span>        dir,<a name="line.133"></a>
<span class="sourceLineNo">134</span>        PARAM_VIEW_NAME,<a name="line.134"></a>
<span class="sourceLineNo">135</span>        viewName,<a name="line.135"></a>
<span class="sourceLineNo">136</span>        PARAM_SUFFIXES,<a name="line.136"></a>
<span class="sourceLineNo">137</span>        suffixes);<a name="line.137"></a>
<span class="sourceLineNo">138</span>  }<a name="line.138"></a>
<span class="sourceLineNo">139</span><a name="line.139"></a>
<span class="sourceLineNo">140</span>  public static CollectionReader getCollectionReaderWithSuffixes(<a name="line.140"></a>
<span class="sourceLineNo">141</span>      String dir,<a name="line.141"></a>
<span class="sourceLineNo">142</span>      String viewName,<a name="line.142"></a>
<span class="sourceLineNo">143</span>      String... suffixes) throws ResourceInitializationException {<a name="line.143"></a>
<span class="sourceLineNo">144</span>    return CollectionReaderFactory.createReader(getDescriptionWithSuffixes(dir, viewName, suffixes));<a name="line.144"></a>
<span class="sourceLineNo">145</span>  }<a name="line.145"></a>
<span class="sourceLineNo">146</span><a name="line.146"></a>
<span class="sourceLineNo">147</span>  public static final String PARAM_ROOT_FILE = "rootFile";<a name="line.147"></a>
<span class="sourceLineNo">148</span><a name="line.148"></a>
<span class="sourceLineNo">149</span>  @ConfigurationParameter(<a name="line.149"></a>
<span class="sourceLineNo">150</span>      name = PARAM_ROOT_FILE,<a name="line.150"></a>
<span class="sourceLineNo">151</span>      mandatory = true,<a name="line.151"></a>
<span class="sourceLineNo">152</span>      description = "takes either the name of a single file or the root directory containing all the files to be processed.")<a name="line.152"></a>
<span class="sourceLineNo">153</span>  protected File rootFile;<a name="line.153"></a>
<span class="sourceLineNo">154</span><a name="line.154"></a>
<span class="sourceLineNo">155</span>  public static final String PARAM_VIEW_NAME = "viewName";<a name="line.155"></a>
<span class="sourceLineNo">156</span><a name="line.156"></a>
<span class="sourceLineNo">157</span>  @ConfigurationParameter(<a name="line.157"></a>
<span class="sourceLineNo">158</span>      name = PARAM_VIEW_NAME,<a name="line.158"></a>
<span class="sourceLineNo">159</span>      mandatory = false,<a name="line.159"></a>
<span class="sourceLineNo">160</span>      description = "takes the the name that should be given to the JCas view that the document texts should be set to.",<a name="line.160"></a>
<span class="sourceLineNo">161</span>      defaultValue = CAS.NAME_DEFAULT_SOFA)<a name="line.161"></a>
<span class="sourceLineNo">162</span>  private String viewName;<a name="line.162"></a>
<span class="sourceLineNo">163</span><a name="line.163"></a>
<span class="sourceLineNo">164</span>  public static final String PARAM_LANGUAGE = "language";<a name="line.164"></a>
<span class="sourceLineNo">165</span><a name="line.165"></a>
<span class="sourceLineNo">166</span>  @ConfigurationParameter(<a name="line.166"></a>
<span class="sourceLineNo">167</span>      name = PARAM_LANGUAGE,<a name="line.167"></a>
<span class="sourceLineNo">168</span>      mandatory = false,<a name="line.168"></a>
<span class="sourceLineNo">169</span>      description = "takes the language code corresponding to the language of the documents being examined.  The value of this parameter "<a name="line.169"></a>
<span class="sourceLineNo">170</span>          + "is simply passed on to JCas.setDocumentLanguage(String).")<a name="line.170"></a>
<span class="sourceLineNo">171</span>  private String language;<a name="line.171"></a>
<span class="sourceLineNo">172</span><a name="line.172"></a>
<span class="sourceLineNo">173</span>  public static final String PARAM_ENCODING = "encoding";<a name="line.173"></a>
<span class="sourceLineNo">174</span><a name="line.174"></a>
<span class="sourceLineNo">175</span>  @ConfigurationParameter(<a name="line.175"></a>
<span class="sourceLineNo">176</span>      name = PARAM_ENCODING,<a name="line.176"></a>
<span class="sourceLineNo">177</span>      mandatory = false,<a name="line.177"></a>
<span class="sourceLineNo">178</span>      description = "takes the encoding of the text files (e.g. \"UTF-8\").  See javadoc for java.nio.charset.Charset for a list of encoding names.")<a name="line.178"></a>
<span class="sourceLineNo">179</span>  private String encoding;<a name="line.179"></a>
<span class="sourceLineNo">180</span><a name="line.180"></a>
<span class="sourceLineNo">181</span>  public static final String PARAM_SUFFIXES = "suffixes";<a name="line.181"></a>
<span class="sourceLineNo">182</span><a name="line.182"></a>
<span class="sourceLineNo">183</span>  @ConfigurationParameter(<a name="line.183"></a>
<span class="sourceLineNo">184</span>      name = PARAM_SUFFIXES,<a name="line.184"></a>
<span class="sourceLineNo">185</span>      mandatory = false,<a name="line.185"></a>
<span class="sourceLineNo">186</span>      description = "takes suffixes (e.g. .txt) of the files that should be read in.")<a name="line.186"></a>
<span class="sourceLineNo">187</span>  private String[] suffixes;<a name="line.187"></a>
<span class="sourceLineNo">188</span><a name="line.188"></a>
<span class="sourceLineNo">189</span>  public static final String PARAM_PATTERNS = "patterns";<a name="line.189"></a>
<span class="sourceLineNo">190</span><a name="line.190"></a>
<span class="sourceLineNo">191</span>  @ConfigurationParameter(<a name="line.191"></a>
<span class="sourceLineNo">192</span>      name = PARAM_PATTERNS,<a name="line.192"></a>
<span class="sourceLineNo">193</span>      mandatory = false,<a name="line.193"></a>
<span class="sourceLineNo">194</span>      description = "   takes regular expressions for matching the files that should be read in. Note that these will be searched for"<a name="line.194"></a>
<span class="sourceLineNo">195</span>          + " using java.util. regex.Matcher.find, so if you want to make sure the entire file name matches a pattern, you should start the string with ^ and end the"<a name="line.195"></a>
<span class="sourceLineNo">196</span>          + " string with $.")<a name="line.196"></a>
<span class="sourceLineNo">197</span>  private String[] patterns;<a name="line.197"></a>
<span class="sourceLineNo">198</span><a name="line.198"></a>
<span class="sourceLineNo">199</span>  public static final String PARAM_NAME_FILES_FILE_NAMES = "nameFilesFileNames";<a name="line.199"></a>
<span class="sourceLineNo">200</span><a name="line.200"></a>
<span class="sourceLineNo">201</span>  @ConfigurationParameter(<a name="line.201"></a>
<span class="sourceLineNo">202</span>      name = PARAM_NAME_FILES_FILE_NAMES,<a name="line.202"></a>
<span class="sourceLineNo">203</span>      mandatory = false,<a name="line.203"></a>
<span class="sourceLineNo">204</span>      description = "names files which contain lists of file names. For example, if the value 'mydata/mylist.txt' is provided, "<a name="line.204"></a>
<span class="sourceLineNo">205</span>          + "then the file 'mylist.txt' should contain a line delimited list of file names.  The file names in the list should not have directory information "<a name="line.205"></a>
<span class="sourceLineNo">206</span>          + "but should just be the names of the files. The directory is determined by 'rootFile' and the files that are processed result from "<a name="line.206"></a>
<span class="sourceLineNo">207</span>          + "traversing the directory structure provided and looking for files with a name found in the lists of file names. That is, no exception will be "<a name="line.207"></a>
<span class="sourceLineNo">208</span>          + "thrown if a file name in the list does not actually correspond to a file.")<a name="line.208"></a>
<span class="sourceLineNo">209</span>  private String[] nameFilesFileNames;<a name="line.209"></a>
<span class="sourceLineNo">210</span><a name="line.210"></a>
<span class="sourceLineNo">211</span>  public static final String PARAM_FILE_NAMES = "fileNames";<a name="line.211"></a>
<span class="sourceLineNo">212</span><a name="line.212"></a>
<span class="sourceLineNo">213</span>  @ConfigurationParameter(<a name="line.213"></a>
<span class="sourceLineNo">214</span>      name = PARAM_FILE_NAMES,<a name="line.214"></a>
<span class="sourceLineNo">215</span>      mandatory = false,<a name="line.215"></a>
<span class="sourceLineNo">216</span>      description = "provides a list of file names that should be read in. The directory of the file names is determined by "<a name="line.216"></a>
<span class="sourceLineNo">217</span>          + "'rootFile' and the files that are processed result from traversing the directory structure provided and looking for files with a name found in the list of file names. "<a name="line.217"></a>
<span class="sourceLineNo">218</span>          + "That is, no exception will be thrown if a file name in the list does not actually correspond to a file.")<a name="line.218"></a>
<span class="sourceLineNo">219</span>  private String[] fileNames;<a name="line.219"></a>
<span class="sourceLineNo">220</span><a name="line.220"></a>
<span class="sourceLineNo">221</span>  public static final String PARAM_IGNORE_SYSTEM_FILES = "ignoreSystemFiles";<a name="line.221"></a>
<span class="sourceLineNo">222</span><a name="line.222"></a>
<span class="sourceLineNo">223</span>  @ConfigurationParameter(<a name="line.223"></a>
<span class="sourceLineNo">224</span>      name = PARAM_IGNORE_SYSTEM_FILES,<a name="line.224"></a>
<span class="sourceLineNo">225</span>      mandatory = false,<a name="line.225"></a>
<span class="sourceLineNo">226</span>      description = "This parameter provides a flag that determines whether file iteration will traverse into directories that begin with a period '.' - to loosely correspond to 'system' files.  Setting this parameter to true will not cause file names that begin with a period to be ignored - just directories. ")<a name="line.226"></a>
<span class="sourceLineNo">227</span>  private boolean ignoreSystemFiles = true;<a name="line.227"></a>
<span class="sourceLineNo">228</span><a name="line.228"></a>
<span class="sourceLineNo">229</span>  protected Iterator&lt;File&gt; files;<a name="line.229"></a>
<span class="sourceLineNo">230</span><a name="line.230"></a>
<span class="sourceLineNo">231</span>  protected File currentFile;<a name="line.231"></a>
<span class="sourceLineNo">232</span><a name="line.232"></a>
<span class="sourceLineNo">233</span>  protected int completed = 0;<a name="line.233"></a>
<span class="sourceLineNo">234</span><a name="line.234"></a>
<span class="sourceLineNo">235</span>  protected int filesCount = 0;<a name="line.235"></a>
<span class="sourceLineNo">236</span><a name="line.236"></a>
<span class="sourceLineNo">237</span>  @Override<a name="line.237"></a>
<span class="sourceLineNo">238</span>  public void initialize(UimaContext context) throws ResourceInitializationException {<a name="line.238"></a>
<span class="sourceLineNo">239</span>    // raise an exception if the root file does not exist<a name="line.239"></a>
<span class="sourceLineNo">240</span>    if (!this.rootFile.exists()) {<a name="line.240"></a>
<span class="sourceLineNo">241</span>      String format = "file or directory %s does not exist";<a name="line.241"></a>
<span class="sourceLineNo">242</span>      String message = String.format(format, rootFile.getPath());<a name="line.242"></a>
<span class="sourceLineNo">243</span>      throw new ResourceInitializationException(new IOException(message));<a name="line.243"></a>
<span class="sourceLineNo">244</span>    }<a name="line.244"></a>
<span class="sourceLineNo">245</span><a name="line.245"></a>
<span class="sourceLineNo">246</span>    if (rootFile.isFile()) {<a name="line.246"></a>
<span class="sourceLineNo">247</span>      files = Arrays.asList(rootFile).iterator();<a name="line.247"></a>
<span class="sourceLineNo">248</span>      filesCount = 1;<a name="line.248"></a>
<span class="sourceLineNo">249</span>    } else {<a name="line.249"></a>
<span class="sourceLineNo">250</span><a name="line.250"></a>
<span class="sourceLineNo">251</span>      files = createFileIterator();<a name="line.251"></a>
<span class="sourceLineNo">252</span>      filesCount = countFiles(createFileIterator());<a name="line.252"></a>
<span class="sourceLineNo">253</span>    }<a name="line.253"></a>
<span class="sourceLineNo">254</span>  }<a name="line.254"></a>
<span class="sourceLineNo">255</span><a name="line.255"></a>
<span class="sourceLineNo">256</span>  protected Iterator&lt;File&gt; createFileIterator() throws ResourceInitializationException {<a name="line.256"></a>
<span class="sourceLineNo">257</span>    IOFileFilter fileFilter = TrueFileFilter.INSTANCE;<a name="line.257"></a>
<span class="sourceLineNo">258</span><a name="line.258"></a>
<span class="sourceLineNo">259</span>    if (suffixes != null) {<a name="line.259"></a>
<span class="sourceLineNo">260</span>      fileFilter = new AndFileFilter(fileFilter, new SuffixFileFilter(suffixes));<a name="line.260"></a>
<span class="sourceLineNo">261</span>    }<a name="line.261"></a>
<span class="sourceLineNo">262</span><a name="line.262"></a>
<span class="sourceLineNo">263</span>    if (patterns != null &amp;&amp; patterns.length &gt; 0) {<a name="line.263"></a>
<span class="sourceLineNo">264</span><a name="line.264"></a>
<span class="sourceLineNo">265</span>      IOFileFilter patternFilter = new RegexFileFilter(Pattern.compile(patterns[0]));<a name="line.265"></a>
<span class="sourceLineNo">266</span>      if (patterns.length &gt; 1) {<a name="line.266"></a>
<span class="sourceLineNo">267</span>        for (int i = 1; i &lt; patterns.length; i++) {<a name="line.267"></a>
<span class="sourceLineNo">268</span>          patternFilter = new OrFileFilter(patternFilter, new RegexFileFilter(patterns[i]));<a name="line.268"></a>
<span class="sourceLineNo">269</span>        }<a name="line.269"></a>
<span class="sourceLineNo">270</span>      }<a name="line.270"></a>
<span class="sourceLineNo">271</span>      fileFilter = new AndFileFilter(fileFilter, patternFilter);<a name="line.271"></a>
<span class="sourceLineNo">272</span><a name="line.272"></a>
<span class="sourceLineNo">273</span>    }<a name="line.273"></a>
<span class="sourceLineNo">274</span><a name="line.274"></a>
<span class="sourceLineNo">275</span>    if (nameFilesFileNames != null) {<a name="line.275"></a>
<span class="sourceLineNo">276</span>      List&lt;String&gt; fileNamesFromLists = new ArrayList&lt;String&gt;();<a name="line.276"></a>
<span class="sourceLineNo">277</span>      try {<a name="line.277"></a>
<span class="sourceLineNo">278</span>        for (String fileNamesList : nameFilesFileNames) {<a name="line.278"></a>
<span class="sourceLineNo">279</span>          fileNamesFromLists.addAll(Arrays.asList(FileUtil.loadListOfStrings(new File(fileNamesList))));<a name="line.279"></a>
<span class="sourceLineNo">280</span>        }<a name="line.280"></a>
<span class="sourceLineNo">281</span>        fileFilter = new AndFileFilter(fileFilter, new NameFileFilter(fileNamesFromLists));<a name="line.281"></a>
<span class="sourceLineNo">282</span>      } catch (IOException ioe) {<a name="line.282"></a>
<span class="sourceLineNo">283</span>        throw new ResourceInitializationException(ioe);<a name="line.283"></a>
<span class="sourceLineNo">284</span>      }<a name="line.284"></a>
<span class="sourceLineNo">285</span>    }<a name="line.285"></a>
<span class="sourceLineNo">286</span><a name="line.286"></a>
<span class="sourceLineNo">287</span>    if (fileNames != null) {<a name="line.287"></a>
<span class="sourceLineNo">288</span>      fileFilter = new AndFileFilter(fileFilter, new NameFileFilter(fileNames));<a name="line.288"></a>
<span class="sourceLineNo">289</span>    }<a name="line.289"></a>
<span class="sourceLineNo">290</span><a name="line.290"></a>
<span class="sourceLineNo">291</span>    IOFileFilter directoryFilter = TrueFileFilter.INSTANCE;<a name="line.291"></a>
<span class="sourceLineNo">292</span><a name="line.292"></a>
<span class="sourceLineNo">293</span>    if (ignoreSystemFiles) {<a name="line.293"></a>
<span class="sourceLineNo">294</span>      directoryFilter = new RegexFileFilter("^[^\\.].*$");<a name="line.294"></a>
<span class="sourceLineNo">295</span>      fileFilter = new AndFileFilter(fileFilter, new RegexFileFilter("^[^\\.].*$"));<a name="line.295"></a>
<span class="sourceLineNo">296</span>    }<a name="line.296"></a>
<span class="sourceLineNo">297</span><a name="line.297"></a>
<span class="sourceLineNo">298</span>    return org.apache.commons.io.FileUtils.iterateFiles(rootFile, fileFilter, directoryFilter);<a name="line.298"></a>
<span class="sourceLineNo">299</span><a name="line.299"></a>
<span class="sourceLineNo">300</span>  }<a name="line.300"></a>
<span class="sourceLineNo">301</span><a name="line.301"></a>
<span class="sourceLineNo">302</span>  public void getNext(JCas jCas) throws IOException, CollectionException {<a name="line.302"></a>
<span class="sourceLineNo">303</span>    if (!hasNext()) {<a name="line.303"></a>
<span class="sourceLineNo">304</span>      throw new RuntimeException("getNext(jCas) was called but hasNext() returns false");<a name="line.304"></a>
<span class="sourceLineNo">305</span>    }<a name="line.305"></a>
<span class="sourceLineNo">306</span>    // get a JCas object<a name="line.306"></a>
<span class="sourceLineNo">307</span>    JCas view;<a name="line.307"></a>
<span class="sourceLineNo">308</span>    try {<a name="line.308"></a>
<span class="sourceLineNo">309</span>      view = ViewCreatorAnnotator.createViewSafely(jCas, this.viewName);<a name="line.309"></a>
<span class="sourceLineNo">310</span>    } catch (AnalysisEngineProcessException e) {<a name="line.310"></a>
<span class="sourceLineNo">311</span>      throw new CollectionException(e);<a name="line.311"></a>
<span class="sourceLineNo">312</span>    }<a name="line.312"></a>
<span class="sourceLineNo">313</span><a name="line.313"></a>
<span class="sourceLineNo">314</span>    // set the document's text<a name="line.314"></a>
<span class="sourceLineNo">315</span>    String text = FileUtils.file2String(currentFile, this.encoding);<a name="line.315"></a>
<span class="sourceLineNo">316</span>    view.setSofaDataString(text, "text/plain");<a name="line.316"></a>
<span class="sourceLineNo">317</span><a name="line.317"></a>
<span class="sourceLineNo">318</span>    // set language if it was specified<a name="line.318"></a>
<span class="sourceLineNo">319</span>    if (this.language != null) {<a name="line.319"></a>
<span class="sourceLineNo">320</span>      view.setDocumentLanguage(this.language);<a name="line.320"></a>
<span class="sourceLineNo">321</span>    }<a name="line.321"></a>
<span class="sourceLineNo">322</span><a name="line.322"></a>
<span class="sourceLineNo">323</span>    // set the document URI<a name="line.323"></a>
<span class="sourceLineNo">324</span>    ViewUriUtil.setURI(jCas, currentFile.toURI());<a name="line.324"></a>
<span class="sourceLineNo">325</span><a name="line.325"></a>
<span class="sourceLineNo">326</span>    completed++;<a name="line.326"></a>
<span class="sourceLineNo">327</span>    currentFile = null;<a name="line.327"></a>
<span class="sourceLineNo">328</span>  }<a name="line.328"></a>
<span class="sourceLineNo">329</span><a name="line.329"></a>
<span class="sourceLineNo">330</span>  protected int countFiles(Iterator&lt;File&gt; tempFiles) {<a name="line.330"></a>
<span class="sourceLineNo">331</span>    int count = 0;<a name="line.331"></a>
<span class="sourceLineNo">332</span>    while (tempFiles.hasNext()) {<a name="line.332"></a>
<span class="sourceLineNo">333</span>      File file = tempFiles.next();<a name="line.333"></a>
<span class="sourceLineNo">334</span>      if (file.isFile())<a name="line.334"></a>
<span class="sourceLineNo">335</span>        count++;<a name="line.335"></a>
<span class="sourceLineNo">336</span>    }<a name="line.336"></a>
<span class="sourceLineNo">337</span>    return count;<a name="line.337"></a>
<span class="sourceLineNo">338</span>  }<a name="line.338"></a>
<span class="sourceLineNo">339</span><a name="line.339"></a>
<span class="sourceLineNo">340</span>  public Progress[] getProgress() {<a name="line.340"></a>
<span class="sourceLineNo">341</span>    Progress progress = new ProgressImpl(completed, filesCount, Progress.ENTITIES);<a name="line.341"></a>
<span class="sourceLineNo">342</span>    return new Progress[] { progress };<a name="line.342"></a>
<span class="sourceLineNo">343</span>  }<a name="line.343"></a>
<span class="sourceLineNo">344</span><a name="line.344"></a>
<span class="sourceLineNo">345</span>  public boolean hasNext() throws IOException, CollectionException {<a name="line.345"></a>
<span class="sourceLineNo">346</span>    if (currentFile != null) {<a name="line.346"></a>
<span class="sourceLineNo">347</span>      return true;<a name="line.347"></a>
<span class="sourceLineNo">348</span>    }<a name="line.348"></a>
<span class="sourceLineNo">349</span>    while (this.files.hasNext()) {<a name="line.349"></a>
<span class="sourceLineNo">350</span>      currentFile = files.next();<a name="line.350"></a>
<span class="sourceLineNo">351</span>      if (currentFile.isFile()) {<a name="line.351"></a>
<span class="sourceLineNo">352</span>        return true;<a name="line.352"></a>
<span class="sourceLineNo">353</span>      }<a name="line.353"></a>
<span class="sourceLineNo">354</span>    }<a name="line.354"></a>
<span class="sourceLineNo">355</span>    return false;<a name="line.355"></a>
<span class="sourceLineNo">356</span>  }<a name="line.356"></a>
<span class="sourceLineNo">357</span><a name="line.357"></a>
<span class="sourceLineNo">358</span>  public void close() throws IOException {<a name="line.358"></a>
<span class="sourceLineNo">359</span>  }<a name="line.359"></a>
<span class="sourceLineNo">360</span>}<a name="line.360"></a>




























































</pre>
</div>
</body>
</html>
