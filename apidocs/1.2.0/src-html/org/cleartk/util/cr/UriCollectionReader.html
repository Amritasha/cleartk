<HTML>
<BODY BGCOLOR="white">
<PRE>
<FONT color="green">001</FONT>    /** <a name="line.1"></a>
<FONT color="green">002</FONT>     * Copyright (c) 2012, Regents of the University of Colorado <a name="line.2"></a>
<FONT color="green">003</FONT>     * All rights reserved.<a name="line.3"></a>
<FONT color="green">004</FONT>     * <a name="line.4"></a>
<FONT color="green">005</FONT>     * Redistribution and use in source and binary forms, with or without<a name="line.5"></a>
<FONT color="green">006</FONT>     * modification, are permitted provided that the following conditions are met:<a name="line.6"></a>
<FONT color="green">007</FONT>     * <a name="line.7"></a>
<FONT color="green">008</FONT>     * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer. <a name="line.8"></a>
<FONT color="green">009</FONT>     * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution. <a name="line.9"></a>
<FONT color="green">010</FONT>     * Neither the name of the University of Colorado at Boulder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission. <a name="line.10"></a>
<FONT color="green">011</FONT>     * <a name="line.11"></a>
<FONT color="green">012</FONT>     * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"<a name="line.12"></a>
<FONT color="green">013</FONT>     * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE<a name="line.13"></a>
<FONT color="green">014</FONT>     * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE<a name="line.14"></a>
<FONT color="green">015</FONT>     * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE<a name="line.15"></a>
<FONT color="green">016</FONT>     * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR<a name="line.16"></a>
<FONT color="green">017</FONT>     * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF<a name="line.17"></a>
<FONT color="green">018</FONT>     * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS<a name="line.18"></a>
<FONT color="green">019</FONT>     * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN<a name="line.19"></a>
<FONT color="green">020</FONT>     * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)<a name="line.20"></a>
<FONT color="green">021</FONT>     * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE<a name="line.21"></a>
<FONT color="green">022</FONT>     * POSSIBILITY OF SUCH DAMAGE. <a name="line.22"></a>
<FONT color="green">023</FONT>     */<a name="line.23"></a>
<FONT color="green">024</FONT>    package org.cleartk.util.cr;<a name="line.24"></a>
<FONT color="green">025</FONT>    <a name="line.25"></a>
<FONT color="green">026</FONT>    import java.io.File;<a name="line.26"></a>
<FONT color="green">027</FONT>    import java.io.FileFilter;<a name="line.27"></a>
<FONT color="green">028</FONT>    import java.io.IOException;<a name="line.28"></a>
<FONT color="green">029</FONT>    import java.net.URI;<a name="line.29"></a>
<FONT color="green">030</FONT>    import java.net.URISyntaxException;<a name="line.30"></a>
<FONT color="green">031</FONT>    import java.util.ArrayList;<a name="line.31"></a>
<FONT color="green">032</FONT>    import java.util.Collection;<a name="line.32"></a>
<FONT color="green">033</FONT>    import java.util.Iterator;<a name="line.33"></a>
<FONT color="green">034</FONT>    <a name="line.34"></a>
<FONT color="green">035</FONT>    import org.apache.commons.io.FileUtils;<a name="line.35"></a>
<FONT color="green">036</FONT>    import org.apache.commons.io.filefilter.FileFilterUtils;<a name="line.36"></a>
<FONT color="green">037</FONT>    import org.apache.commons.io.filefilter.HiddenFileFilter;<a name="line.37"></a>
<FONT color="green">038</FONT>    import org.apache.commons.io.filefilter.IOFileFilter;<a name="line.38"></a>
<FONT color="green">039</FONT>    import org.apache.uima.UimaContext;<a name="line.39"></a>
<FONT color="green">040</FONT>    import org.apache.uima.collection.CollectionException;<a name="line.40"></a>
<FONT color="green">041</FONT>    import org.apache.uima.collection.CollectionReader;<a name="line.41"></a>
<FONT color="green">042</FONT>    import org.apache.uima.collection.CollectionReaderDescription;<a name="line.42"></a>
<FONT color="green">043</FONT>    import org.apache.uima.jcas.JCas;<a name="line.43"></a>
<FONT color="green">044</FONT>    import org.apache.uima.resource.ResourceInitializationException;<a name="line.44"></a>
<FONT color="green">045</FONT>    import org.apache.uima.util.Progress;<a name="line.45"></a>
<FONT color="green">046</FONT>    import org.apache.uima.util.ProgressImpl;<a name="line.46"></a>
<FONT color="green">047</FONT>    import org.cleartk.util.ViewURIUtil;<a name="line.47"></a>
<FONT color="green">048</FONT>    import org.uimafit.component.JCasCollectionReader_ImplBase;<a name="line.48"></a>
<FONT color="green">049</FONT>    import org.uimafit.descriptor.ConfigurationParameter;<a name="line.49"></a>
<FONT color="green">050</FONT>    import org.uimafit.factory.CollectionReaderFactory;<a name="line.50"></a>
<FONT color="green">051</FONT>    import org.uimafit.factory.ConfigurationParameterFactory;<a name="line.51"></a>
<FONT color="green">052</FONT>    <a name="line.52"></a>
<FONT color="green">053</FONT>    import com.google.common.base.Function;<a name="line.53"></a>
<FONT color="green">054</FONT>    import com.google.common.collect.Iterables;<a name="line.54"></a>
<FONT color="green">055</FONT>    <a name="line.55"></a>
<FONT color="green">056</FONT>    /**<a name="line.56"></a>
<FONT color="green">057</FONT>     * &lt;br&gt;<a name="line.57"></a>
<FONT color="green">058</FONT>     * Copyright (c) 2012, Regents of the University of Colorado &lt;br&gt;<a name="line.58"></a>
<FONT color="green">059</FONT>     * All rights reserved.<a name="line.59"></a>
<FONT color="green">060</FONT>     * &lt;p&gt;<a name="line.60"></a>
<FONT color="green">061</FONT>     * <a name="line.61"></a>
<FONT color="green">062</FONT>     * A CollectionReader that populates the default sofa with URI. This can accept a Collection of<a name="line.62"></a>
<FONT color="green">063</FONT>     * Files, Collection of URIs or a single directory. If given a directory it will create a jCas for<a name="line.63"></a>
<FONT color="green">064</FONT>     * each file within the directory. Recursion is controlled using the directoryFilter parameter. By<a name="line.64"></a>
<FONT color="green">065</FONT>     * default this will reject system files and recurse into subdirectories.<a name="line.65"></a>
<FONT color="green">066</FONT>     * &lt;p&gt;<a name="line.66"></a>
<FONT color="green">067</FONT>     * This should be used in conjunction with UriToDocumentTextAnnotator or UriToXmiCasAnnotator<a name="line.67"></a>
<FONT color="green">068</FONT>     * <a name="line.68"></a>
<FONT color="green">069</FONT>     * @author Lee Becker<a name="line.69"></a>
<FONT color="green">070</FONT>     * <a name="line.70"></a>
<FONT color="green">071</FONT>     */<a name="line.71"></a>
<FONT color="green">072</FONT>    public class UriCollectionReader extends JCasCollectionReader_ImplBase {<a name="line.72"></a>
<FONT color="green">073</FONT>    <a name="line.73"></a>
<FONT color="green">074</FONT>      public static class RejectSystemFiles implements IOFileFilter {<a name="line.74"></a>
<FONT color="green">075</FONT>        FileFilter f = FileFilterUtils.fileFileFilter();<a name="line.75"></a>
<FONT color="green">076</FONT>    <a name="line.76"></a>
<FONT color="green">077</FONT>        @Override<a name="line.77"></a>
<FONT color="green">078</FONT>        public boolean accept(File file) {<a name="line.78"></a>
<FONT color="green">079</FONT>          return FileFilterUtils.fileFileFilter().accept(file) &amp;&amp; HiddenFileFilter.VISIBLE.accept(file);<a name="line.79"></a>
<FONT color="green">080</FONT>        }<a name="line.80"></a>
<FONT color="green">081</FONT>    <a name="line.81"></a>
<FONT color="green">082</FONT>        @Override<a name="line.82"></a>
<FONT color="green">083</FONT>        public boolean accept(File dir, String name) {<a name="line.83"></a>
<FONT color="green">084</FONT>          File file = new File(dir, name);<a name="line.84"></a>
<FONT color="green">085</FONT>          return FileFilterUtils.directoryFileFilter().accept(file)<a name="line.85"></a>
<FONT color="green">086</FONT>              &amp;&amp; HiddenFileFilter.VISIBLE.accept(file) &amp;&amp; this.accept(file);<a name="line.86"></a>
<FONT color="green">087</FONT>        }<a name="line.87"></a>
<FONT color="green">088</FONT>      }<a name="line.88"></a>
<FONT color="green">089</FONT>    <a name="line.89"></a>
<FONT color="green">090</FONT>      public static class RejectSystemDirectories implements IOFileFilter {<a name="line.90"></a>
<FONT color="green">091</FONT>    <a name="line.91"></a>
<FONT color="green">092</FONT>        @Override<a name="line.92"></a>
<FONT color="green">093</FONT>        public boolean accept(File file) {<a name="line.93"></a>
<FONT color="green">094</FONT>          return FileFilterUtils.directoryFileFilter().accept(file)<a name="line.94"></a>
<FONT color="green">095</FONT>              &amp;&amp; HiddenFileFilter.VISIBLE.accept(file);<a name="line.95"></a>
<FONT color="green">096</FONT>        }<a name="line.96"></a>
<FONT color="green">097</FONT>    <a name="line.97"></a>
<FONT color="green">098</FONT>        @Override<a name="line.98"></a>
<FONT color="green">099</FONT>        public boolean accept(File dir, String name) {<a name="line.99"></a>
<FONT color="green">100</FONT>          File file = new File(dir, name);<a name="line.100"></a>
<FONT color="green">101</FONT>          return FileFilterUtils.directoryFileFilter().accept(file)<a name="line.101"></a>
<FONT color="green">102</FONT>              &amp;&amp; HiddenFileFilter.VISIBLE.accept(file) &amp;&amp; this.accept(file);<a name="line.102"></a>
<FONT color="green">103</FONT>        }<a name="line.103"></a>
<FONT color="green">104</FONT>      }<a name="line.104"></a>
<FONT color="green">105</FONT>    <a name="line.105"></a>
<FONT color="green">106</FONT>      public static CollectionReaderDescription getDescriptionFromDirectory(File directory)<a name="line.106"></a>
<FONT color="green">107</FONT>          throws ResourceInitializationException {<a name="line.107"></a>
<FONT color="green">108</FONT>        return CollectionReaderFactory.createDescription(<a name="line.108"></a>
<FONT color="green">109</FONT>            UriCollectionReader.class,<a name="line.109"></a>
<FONT color="green">110</FONT>            null,<a name="line.110"></a>
<FONT color="green">111</FONT>            PARAM_DIRECTORY,<a name="line.111"></a>
<FONT color="green">112</FONT>            directory);<a name="line.112"></a>
<FONT color="green">113</FONT>      }<a name="line.113"></a>
<FONT color="green">114</FONT>    <a name="line.114"></a>
<FONT color="green">115</FONT>      public static CollectionReaderDescription getDescriptionFromDirectory(<a name="line.115"></a>
<FONT color="green">116</FONT>          File directory,<a name="line.116"></a>
<FONT color="green">117</FONT>          Class&lt;? extends IOFileFilter&gt; fileFilterClass,<a name="line.117"></a>
<FONT color="green">118</FONT>          Class&lt;? extends IOFileFilter&gt; dirFilterClass) throws ResourceInitializationException {<a name="line.118"></a>
<FONT color="green">119</FONT>        return CollectionReaderFactory.createDescription(<a name="line.119"></a>
<FONT color="green">120</FONT>            UriCollectionReader.class,<a name="line.120"></a>
<FONT color="green">121</FONT>            null,<a name="line.121"></a>
<FONT color="green">122</FONT>            PARAM_DIRECTORY,<a name="line.122"></a>
<FONT color="green">123</FONT>            directory,<a name="line.123"></a>
<FONT color="green">124</FONT>            PARAM_FILE_FILTER_CLASS,<a name="line.124"></a>
<FONT color="green">125</FONT>            fileFilterClass,<a name="line.125"></a>
<FONT color="green">126</FONT>            PARAM_DIRECTORY_FILTER_CLASS,<a name="line.126"></a>
<FONT color="green">127</FONT>            dirFilterClass);<a name="line.127"></a>
<FONT color="green">128</FONT>      }<a name="line.128"></a>
<FONT color="green">129</FONT>    <a name="line.129"></a>
<FONT color="green">130</FONT>      public static CollectionReader getCollectionReaderFromDirectory(File directory)<a name="line.130"></a>
<FONT color="green">131</FONT>          throws ResourceInitializationException {<a name="line.131"></a>
<FONT color="green">132</FONT>        return CollectionReaderFactory.createCollectionReader(getDescriptionFromDirectory(directory));<a name="line.132"></a>
<FONT color="green">133</FONT>      }<a name="line.133"></a>
<FONT color="green">134</FONT>    <a name="line.134"></a>
<FONT color="green">135</FONT>      public static CollectionReader getCollectionReaderFromDirectory(<a name="line.135"></a>
<FONT color="green">136</FONT>          File directory,<a name="line.136"></a>
<FONT color="green">137</FONT>          Class&lt;? extends IOFileFilter&gt; fileFilterClass,<a name="line.137"></a>
<FONT color="green">138</FONT>          Class&lt;? extends IOFileFilter&gt; dirFilterClass) throws ResourceInitializationException {<a name="line.138"></a>
<FONT color="green">139</FONT>        return CollectionReaderFactory.createCollectionReader(getDescriptionFromDirectory(<a name="line.139"></a>
<FONT color="green">140</FONT>            directory,<a name="line.140"></a>
<FONT color="green">141</FONT>            fileFilterClass,<a name="line.141"></a>
<FONT color="green">142</FONT>            dirFilterClass));<a name="line.142"></a>
<FONT color="green">143</FONT>      }<a name="line.143"></a>
<FONT color="green">144</FONT>    <a name="line.144"></a>
<FONT color="green">145</FONT>      public static CollectionReaderDescription getDescriptionFromFiles(Collection&lt;File&gt; files)<a name="line.145"></a>
<FONT color="green">146</FONT>          throws ResourceInitializationException {<a name="line.146"></a>
<FONT color="green">147</FONT>    <a name="line.147"></a>
<FONT color="green">148</FONT>        return CollectionReaderFactory.createDescription(<a name="line.148"></a>
<FONT color="green">149</FONT>            UriCollectionReader.class,<a name="line.149"></a>
<FONT color="green">150</FONT>            null,<a name="line.150"></a>
<FONT color="green">151</FONT>            PARAM_FILES,<a name="line.151"></a>
<FONT color="green">152</FONT>            files);<a name="line.152"></a>
<FONT color="green">153</FONT>      }<a name="line.153"></a>
<FONT color="green">154</FONT>    <a name="line.154"></a>
<FONT color="green">155</FONT>      public static CollectionReader getCollectionReaderFromFiles(Collection&lt;File&gt; files)<a name="line.155"></a>
<FONT color="green">156</FONT>          throws ResourceInitializationException {<a name="line.156"></a>
<FONT color="green">157</FONT>        return CollectionReaderFactory.createCollectionReader(getDescriptionFromFiles(files));<a name="line.157"></a>
<FONT color="green">158</FONT>      }<a name="line.158"></a>
<FONT color="green">159</FONT>    <a name="line.159"></a>
<FONT color="green">160</FONT>      public static CollectionReaderDescription getDescriptionFromUris(Collection&lt;URI&gt; uris)<a name="line.160"></a>
<FONT color="green">161</FONT>          throws ResourceInitializationException {<a name="line.161"></a>
<FONT color="green">162</FONT>    <a name="line.162"></a>
<FONT color="green">163</FONT>        return CollectionReaderFactory.createDescription(<a name="line.163"></a>
<FONT color="green">164</FONT>            UriCollectionReader.class,<a name="line.164"></a>
<FONT color="green">165</FONT>            null,<a name="line.165"></a>
<FONT color="green">166</FONT>            PARAM_URIS,<a name="line.166"></a>
<FONT color="green">167</FONT>            uris);<a name="line.167"></a>
<FONT color="green">168</FONT>      }<a name="line.168"></a>
<FONT color="green">169</FONT>    <a name="line.169"></a>
<FONT color="green">170</FONT>      public static CollectionReader getCollectionReaderFromUris(Collection&lt;URI&gt; uris)<a name="line.170"></a>
<FONT color="green">171</FONT>          throws ResourceInitializationException {<a name="line.171"></a>
<FONT color="green">172</FONT>        return CollectionReaderFactory.createCollectionReader(getDescriptionFromUris(uris));<a name="line.172"></a>
<FONT color="green">173</FONT>      }<a name="line.173"></a>
<FONT color="green">174</FONT>    <a name="line.174"></a>
<FONT color="green">175</FONT>      public static final String PARAM_FILES = ConfigurationParameterFactory.createConfigurationParameterName(<a name="line.175"></a>
<FONT color="green">176</FONT>          UriCollectionReader.class,<a name="line.176"></a>
<FONT color="green">177</FONT>          "files");<a name="line.177"></a>
<FONT color="green">178</FONT>    <a name="line.178"></a>
<FONT color="green">179</FONT>      @ConfigurationParameter(<a name="line.179"></a>
<FONT color="green">180</FONT>          description = "provides a list of files whose URI should be written to the default sofa within the CAS")<a name="line.180"></a>
<FONT color="green">181</FONT>      private Collection&lt;File&gt; files = new ArrayList&lt;File&gt;();<a name="line.181"></a>
<FONT color="green">182</FONT>    <a name="line.182"></a>
<FONT color="green">183</FONT>      public static final String PARAM_DIRECTORY = ConfigurationParameterFactory.createConfigurationParameterName(<a name="line.183"></a>
<FONT color="green">184</FONT>          UriCollectionReader.class,<a name="line.184"></a>
<FONT color="green">185</FONT>          "directory");<a name="line.185"></a>
<FONT color="green">186</FONT>    <a name="line.186"></a>
<FONT color="green">187</FONT>      @ConfigurationParameter(<a name="line.187"></a>
<FONT color="green">188</FONT>          description = "provids a directory containing files whose URIs should be written to the defaul sofa within the CAS")<a name="line.188"></a>
<FONT color="green">189</FONT>      private File directory = null;<a name="line.189"></a>
<FONT color="green">190</FONT>    <a name="line.190"></a>
<FONT color="green">191</FONT>      public static final String PARAM_URIS = ConfigurationParameterFactory.createConfigurationParameterName(<a name="line.191"></a>
<FONT color="green">192</FONT>          UriCollectionReader.class,<a name="line.192"></a>
<FONT color="green">193</FONT>          "uris");<a name="line.193"></a>
<FONT color="green">194</FONT>    <a name="line.194"></a>
<FONT color="green">195</FONT>      @ConfigurationParameter(<a name="line.195"></a>
<FONT color="green">196</FONT>          description = "This parameter provides a list of URIs that should be written to the default sofa within the CAS.  Proper URI construction is the responsibility of the caller")<a name="line.196"></a>
<FONT color="green">197</FONT>      private Collection&lt;URI&gt; uris = new ArrayList&lt;URI&gt;();<a name="line.197"></a>
<FONT color="green">198</FONT>    <a name="line.198"></a>
<FONT color="green">199</FONT>      public static final String PARAM_FILE_FILTER_CLASS = ConfigurationParameterFactory.createConfigurationParameterName(<a name="line.199"></a>
<FONT color="green">200</FONT>          UriCollectionReader.class,<a name="line.200"></a>
<FONT color="green">201</FONT>          "fileFilterClass");<a name="line.201"></a>
<FONT color="green">202</FONT>    <a name="line.202"></a>
<FONT color="green">203</FONT>      @ConfigurationParameter(<a name="line.203"></a>
<FONT color="green">204</FONT>          defaultValue = "org.cleartk.util.cr.UriCollectionReader.RejectSystemFiles",<a name="line.204"></a>
<FONT color="green">205</FONT>          mandatory = false,<a name="line.205"></a>
<FONT color="green">206</FONT>          description = "The class used for filtering files when PARAM_DIRECTORY is set")<a name="line.206"></a>
<FONT color="green">207</FONT>      private Class&lt;? extends IOFileFilter&gt; fileFilterClass;<a name="line.207"></a>
<FONT color="green">208</FONT>    <a name="line.208"></a>
<FONT color="green">209</FONT>      public static final String PARAM_DIRECTORY_FILTER_CLASS = ConfigurationParameterFactory.createConfigurationParameterName(<a name="line.209"></a>
<FONT color="green">210</FONT>          UriCollectionReader.class,<a name="line.210"></a>
<FONT color="green">211</FONT>          "directoryFilterClass");<a name="line.211"></a>
<FONT color="green">212</FONT>    <a name="line.212"></a>
<FONT color="green">213</FONT>      @ConfigurationParameter(<a name="line.213"></a>
<FONT color="green">214</FONT>          defaultValue = "org.cleartk.util.cr.UriCollectionReader.RejectSystemDirectories",<a name="line.214"></a>
<FONT color="green">215</FONT>          mandatory = false,<a name="line.215"></a>
<FONT color="green">216</FONT>          description = "The class used for filtering sub-directories when PARAM_DIRECTORY is set.  To disable recursion, pass in a directory filter that rejects all directory files")<a name="line.216"></a>
<FONT color="green">217</FONT>      private Class&lt;? extends IOFileFilter&gt; directoryFilterClass;<a name="line.217"></a>
<FONT color="green">218</FONT>    <a name="line.218"></a>
<FONT color="green">219</FONT>      protected Iterator&lt;URI&gt; uriIter;<a name="line.219"></a>
<FONT color="green">220</FONT>    <a name="line.220"></a>
<FONT color="green">221</FONT>      protected int numUrisCompleted = 0;<a name="line.221"></a>
<FONT color="green">222</FONT>    <a name="line.222"></a>
<FONT color="green">223</FONT>      protected int uriCount = 0;<a name="line.223"></a>
<FONT color="green">224</FONT>    <a name="line.224"></a>
<FONT color="green">225</FONT>      protected Function&lt;String, URI&gt; stringToUri = new Function&lt;String, URI&gt;() {<a name="line.225"></a>
<FONT color="green">226</FONT>        @Override<a name="line.226"></a>
<FONT color="green">227</FONT>        public URI apply(String input) {<a name="line.227"></a>
<FONT color="green">228</FONT>          try {<a name="line.228"></a>
<FONT color="green">229</FONT>            return new URI(input);<a name="line.229"></a>
<FONT color="green">230</FONT>          } catch (URISyntaxException e) {<a name="line.230"></a>
<FONT color="green">231</FONT>            throw new RuntimeException(e);<a name="line.231"></a>
<FONT color="green">232</FONT>          }<a name="line.232"></a>
<FONT color="green">233</FONT>        }<a name="line.233"></a>
<FONT color="green">234</FONT>      };<a name="line.234"></a>
<FONT color="green">235</FONT>    <a name="line.235"></a>
<FONT color="green">236</FONT>      protected Function&lt;File, URI&gt; fileToUri = new Function&lt;File, URI&gt;() {<a name="line.236"></a>
<FONT color="green">237</FONT>        @Override<a name="line.237"></a>
<FONT color="green">238</FONT>        public URI apply(File input) {<a name="line.238"></a>
<FONT color="green">239</FONT>          return input.toURI();<a name="line.239"></a>
<FONT color="green">240</FONT>        }<a name="line.240"></a>
<FONT color="green">241</FONT>      };<a name="line.241"></a>
<FONT color="green">242</FONT>    <a name="line.242"></a>
<FONT color="green">243</FONT>      @Override<a name="line.243"></a>
<FONT color="green">244</FONT>      public void initialize(UimaContext context) throws ResourceInitializationException {<a name="line.244"></a>
<FONT color="green">245</FONT>    <a name="line.245"></a>
<FONT color="green">246</FONT>        // Convert list of files to URIs<a name="line.246"></a>
<FONT color="green">247</FONT>        // Iterable&lt;File&gt; filteredFiles = Iterables.filter(this.files, this.directoryFilesFilter);<a name="line.247"></a>
<FONT color="green">248</FONT>        this.uriCount += this.files.size();<a name="line.248"></a>
<FONT color="green">249</FONT>        Iterable&lt;URI&gt; urisFromFiles = Iterables.transform(this.files, this.fileToUri);<a name="line.249"></a>
<FONT color="green">250</FONT>    <a name="line.250"></a>
<FONT color="green">251</FONT>        // Read file names from directory and convert list of files to URI<a name="line.251"></a>
<FONT color="green">252</FONT>        Iterable&lt;URI&gt; urisFromDirectory = new ArrayList&lt;URI&gt;();<a name="line.252"></a>
<FONT color="green">253</FONT>        if (this.isDirectoryValid()) {<a name="line.253"></a>
<FONT color="green">254</FONT>          IOFileFilter fileFilter;<a name="line.254"></a>
<FONT color="green">255</FONT>          IOFileFilter directoryFilter;<a name="line.255"></a>
<FONT color="green">256</FONT>    <a name="line.256"></a>
<FONT color="green">257</FONT>          try {<a name="line.257"></a>
<FONT color="green">258</FONT>            fileFilter = this.fileFilterClass.newInstance();<a name="line.258"></a>
<FONT color="green">259</FONT>            directoryFilter = this.directoryFilterClass.newInstance();<a name="line.259"></a>
<FONT color="green">260</FONT>          } catch (InstantiationException e) {<a name="line.260"></a>
<FONT color="green">261</FONT>            throw new ResourceInitializationException(e);<a name="line.261"></a>
<FONT color="green">262</FONT>          } catch (IllegalAccessException e) {<a name="line.262"></a>
<FONT color="green">263</FONT>            throw new ResourceInitializationException(e);<a name="line.263"></a>
<FONT color="green">264</FONT>          }<a name="line.264"></a>
<FONT color="green">265</FONT>    <a name="line.265"></a>
<FONT color="green">266</FONT>          Collection&lt;File&gt; filesInDir = FileUtils.listFiles(this.directory, fileFilter, directoryFilter);<a name="line.266"></a>
<FONT color="green">267</FONT>          urisFromDirectory = Iterables.transform(filesInDir, this.fileToUri);<a name="line.267"></a>
<FONT color="green">268</FONT>          this.uriCount += filesInDir.size();<a name="line.268"></a>
<FONT color="green">269</FONT>        }<a name="line.269"></a>
<FONT color="green">270</FONT>    <a name="line.270"></a>
<FONT color="green">271</FONT>        // Combine URI iterables from all conditions and initialize iterator<a name="line.271"></a>
<FONT color="green">272</FONT>        this.uriIter = Iterables.concat(this.uris, urisFromFiles, urisFromDirectory).iterator();<a name="line.272"></a>
<FONT color="green">273</FONT>      }<a name="line.273"></a>
<FONT color="green">274</FONT>    <a name="line.274"></a>
<FONT color="green">275</FONT>      private boolean isDirectoryValid() throws ResourceInitializationException {<a name="line.275"></a>
<FONT color="green">276</FONT>        if (this.directory == null) {<a name="line.276"></a>
<FONT color="green">277</FONT>          return false;<a name="line.277"></a>
<FONT color="green">278</FONT>        }<a name="line.278"></a>
<FONT color="green">279</FONT>    <a name="line.279"></a>
<FONT color="green">280</FONT>        if (!this.directory.exists()) {<a name="line.280"></a>
<FONT color="green">281</FONT>          String format = "Directory %s does not exist";<a name="line.281"></a>
<FONT color="green">282</FONT>          String message = String.format(format, directory.getPath());<a name="line.282"></a>
<FONT color="green">283</FONT>          throw new ResourceInitializationException(new IOException(message));<a name="line.283"></a>
<FONT color="green">284</FONT>        }<a name="line.284"></a>
<FONT color="green">285</FONT>    <a name="line.285"></a>
<FONT color="green">286</FONT>        if (!this.directory.isDirectory()) {<a name="line.286"></a>
<FONT color="green">287</FONT>          String format = "Directory %s is not a directory.  For specific files set PARAM_FILES instead of PARAM_DIRECTORY.";<a name="line.287"></a>
<FONT color="green">288</FONT>          String message = String.format(format, directory.getPath());<a name="line.288"></a>
<FONT color="green">289</FONT>          throw new ResourceInitializationException(new IOException(message));<a name="line.289"></a>
<FONT color="green">290</FONT>        }<a name="line.290"></a>
<FONT color="green">291</FONT>        return true;<a name="line.291"></a>
<FONT color="green">292</FONT>      }<a name="line.292"></a>
<FONT color="green">293</FONT>    <a name="line.293"></a>
<FONT color="green">294</FONT>      @Override<a name="line.294"></a>
<FONT color="green">295</FONT>      public boolean hasNext() throws IOException, CollectionException {<a name="line.295"></a>
<FONT color="green">296</FONT>        return this.uriIter.hasNext();<a name="line.296"></a>
<FONT color="green">297</FONT>      }<a name="line.297"></a>
<FONT color="green">298</FONT>    <a name="line.298"></a>
<FONT color="green">299</FONT>      @Override<a name="line.299"></a>
<FONT color="green">300</FONT>      public Progress[] getProgress() {<a name="line.300"></a>
<FONT color="green">301</FONT>        Progress progress = new ProgressImpl(numUrisCompleted, uriCount, Progress.ENTITIES);<a name="line.301"></a>
<FONT color="green">302</FONT>        return new Progress[] { progress };<a name="line.302"></a>
<FONT color="green">303</FONT>      }<a name="line.303"></a>
<FONT color="green">304</FONT>    <a name="line.304"></a>
<FONT color="green">305</FONT>      @Override<a name="line.305"></a>
<FONT color="green">306</FONT>      public void getNext(JCas jCas) throws IOException, CollectionException {<a name="line.306"></a>
<FONT color="green">307</FONT>        if (!this.hasNext()) {<a name="line.307"></a>
<FONT color="green">308</FONT>          throw new RuntimeException("getNext(jCas) was called but hasNext() returns false");<a name="line.308"></a>
<FONT color="green">309</FONT>        }<a name="line.309"></a>
<FONT color="green">310</FONT>    <a name="line.310"></a>
<FONT color="green">311</FONT>        ViewURIUtil.setURI(jCas, this.uriIter.next());<a name="line.311"></a>
<FONT color="green">312</FONT>      }<a name="line.312"></a>
<FONT color="green">313</FONT>    <a name="line.313"></a>
<FONT color="green">314</FONT>    }<a name="line.314"></a>




























































</PRE>
</BODY>
</HTML>
