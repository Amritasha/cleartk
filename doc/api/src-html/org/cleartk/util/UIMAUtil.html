<HTML>
<BODY BGCOLOR="white">
<PRE>
<FONT color="green">001</FONT>    /** <a name="line.1"></a>
<FONT color="green">002</FONT>     * Copyright (c) 2007-2008, Regents of the University of Colorado <a name="line.2"></a>
<FONT color="green">003</FONT>     * All rights reserved.<a name="line.3"></a>
<FONT color="green">004</FONT>     * <a name="line.4"></a>
<FONT color="green">005</FONT>     * Redistribution and use in source and binary forms, with or without<a name="line.5"></a>
<FONT color="green">006</FONT>     * modification, are permitted provided that the following conditions are met:<a name="line.6"></a>
<FONT color="green">007</FONT>     * <a name="line.7"></a>
<FONT color="green">008</FONT>     * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer. <a name="line.8"></a>
<FONT color="green">009</FONT>     * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution. <a name="line.9"></a>
<FONT color="green">010</FONT>     * Neither the name of the University of Colorado at Boulder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission. <a name="line.10"></a>
<FONT color="green">011</FONT>     * <a name="line.11"></a>
<FONT color="green">012</FONT>     * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"<a name="line.12"></a>
<FONT color="green">013</FONT>     * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE<a name="line.13"></a>
<FONT color="green">014</FONT>     * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE<a name="line.14"></a>
<FONT color="green">015</FONT>     * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE<a name="line.15"></a>
<FONT color="green">016</FONT>     * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR<a name="line.16"></a>
<FONT color="green">017</FONT>     * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF<a name="line.17"></a>
<FONT color="green">018</FONT>     * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS<a name="line.18"></a>
<FONT color="green">019</FONT>     * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN<a name="line.19"></a>
<FONT color="green">020</FONT>     * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)<a name="line.20"></a>
<FONT color="green">021</FONT>     * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE<a name="line.21"></a>
<FONT color="green">022</FONT>     * POSSIBILITY OF SUCH DAMAGE. <a name="line.22"></a>
<FONT color="green">023</FONT>     */<a name="line.23"></a>
<FONT color="green">024</FONT>    package org.cleartk.util;<a name="line.24"></a>
<FONT color="green">025</FONT>    <a name="line.25"></a>
<FONT color="green">026</FONT>    import java.io.IOException;<a name="line.26"></a>
<FONT color="green">027</FONT>    import java.io.InputStream;<a name="line.27"></a>
<FONT color="green">028</FONT>    import java.lang.reflect.Modifier;<a name="line.28"></a>
<FONT color="green">029</FONT>    import java.util.ArrayList;<a name="line.29"></a>
<FONT color="green">030</FONT>    import java.util.List;<a name="line.30"></a>
<FONT color="green">031</FONT>    <a name="line.31"></a>
<FONT color="green">032</FONT>    import org.apache.uima.UIMAException;<a name="line.32"></a>
<FONT color="green">033</FONT>    import org.apache.uima.UimaContext;<a name="line.33"></a>
<FONT color="green">034</FONT>    import org.apache.uima.analysis_engine.AnalysisEngine;<a name="line.34"></a>
<FONT color="green">035</FONT>    import org.apache.uima.analysis_engine.AnalysisEngineDescription;<a name="line.35"></a>
<FONT color="green">036</FONT>    import org.apache.uima.cas.CAS;<a name="line.36"></a>
<FONT color="green">037</FONT>    import org.apache.uima.cas.CASException;<a name="line.37"></a>
<FONT color="green">038</FONT>    import org.apache.uima.cas.FeatureStructure;<a name="line.38"></a>
<FONT color="green">039</FONT>    import org.apache.uima.cas.Type;<a name="line.39"></a>
<FONT color="green">040</FONT>    import org.apache.uima.collection.CollectionException;<a name="line.40"></a>
<FONT color="green">041</FONT>    import org.apache.uima.collection.CollectionReader;<a name="line.41"></a>
<FONT color="green">042</FONT>    import org.apache.uima.jcas.JCas;<a name="line.42"></a>
<FONT color="green">043</FONT>    import org.apache.uima.jcas.cas.FSArray;<a name="line.43"></a>
<FONT color="green">044</FONT>    import org.apache.uima.jcas.cas.StringArray;<a name="line.44"></a>
<FONT color="green">045</FONT>    import org.apache.uima.jcas.cas.TOP;<a name="line.45"></a>
<FONT color="green">046</FONT>    import org.apache.uima.resource.ResourceInitializationException;<a name="line.46"></a>
<FONT color="green">047</FONT>    import org.cleartk.Initializable;<a name="line.47"></a>
<FONT color="green">048</FONT>    import org.uutuc.factory.AnalysisEngineFactory;<a name="line.48"></a>
<FONT color="green">049</FONT>    import org.uutuc.util.JCasIterable;<a name="line.49"></a>
<FONT color="green">050</FONT>    <a name="line.50"></a>
<FONT color="green">051</FONT>    /**<a name="line.51"></a>
<FONT color="green">052</FONT>     * &lt;br&gt;<a name="line.52"></a>
<FONT color="green">053</FONT>     * Copyright (c) 2007-2008, Regents of the University of Colorado &lt;br&gt;<a name="line.53"></a>
<FONT color="green">054</FONT>     * All rights reserved.<a name="line.54"></a>
<FONT color="green">055</FONT>     * <a name="line.55"></a>
<FONT color="green">056</FONT>     * <a name="line.56"></a>
<FONT color="green">057</FONT>     * @author Philip Ogren<a name="line.57"></a>
<FONT color="green">058</FONT>     * @author Philipp Wetzler<a name="line.58"></a>
<FONT color="green">059</FONT>     * @author Steven Bethard<a name="line.59"></a>
<FONT color="green">060</FONT>     * <a name="line.60"></a>
<FONT color="green">061</FONT>     */<a name="line.61"></a>
<FONT color="green">062</FONT>    public class UIMAUtil {<a name="line.62"></a>
<FONT color="green">063</FONT>            public static FSArray toFSArray(JCas jCas, List&lt;? extends FeatureStructure&gt; fsList) {<a name="line.63"></a>
<FONT color="green">064</FONT>                    if (fsList == null) {<a name="line.64"></a>
<FONT color="green">065</FONT>                            return new FSArray(jCas, 0);<a name="line.65"></a>
<FONT color="green">066</FONT>                    }<a name="line.66"></a>
<FONT color="green">067</FONT>                    FSArray fsArray = new FSArray(jCas, fsList.size());<a name="line.67"></a>
<FONT color="green">068</FONT>                    fsArray.copyFromArray(fsList.toArray(new FeatureStructure[fsList.size()]), 0, 0, fsList.size());<a name="line.68"></a>
<FONT color="green">069</FONT>                    return fsArray;<a name="line.69"></a>
<FONT color="green">070</FONT>            }<a name="line.70"></a>
<FONT color="green">071</FONT>    <a name="line.71"></a>
<FONT color="green">072</FONT>            public static StringArray toStringArray(JCas jCas, String[] sArray) {<a name="line.72"></a>
<FONT color="green">073</FONT>                    StringArray uimaSArray = new StringArray(jCas, sArray.length);<a name="line.73"></a>
<FONT color="green">074</FONT>                    uimaSArray.copyFromArray(sArray, 0, 0, sArray.length);<a name="line.74"></a>
<FONT color="green">075</FONT>                    return uimaSArray;<a name="line.75"></a>
<FONT color="green">076</FONT>            }<a name="line.76"></a>
<FONT color="green">077</FONT>    <a name="line.77"></a>
<FONT color="green">078</FONT>            public static &lt;T extends FeatureStructure&gt; List&lt;T&gt; toList(FSArray fsArray, Class&lt;T&gt; cls) {<a name="line.78"></a>
<FONT color="green">079</FONT>                    List&lt;T&gt; list = new ArrayList&lt;T&gt;();<a name="line.79"></a>
<FONT color="green">080</FONT>    <a name="line.80"></a>
<FONT color="green">081</FONT>                    if (fsArray == null) {<a name="line.81"></a>
<FONT color="green">082</FONT>                            return list;<a name="line.82"></a>
<FONT color="green">083</FONT>                    }<a name="line.83"></a>
<FONT color="green">084</FONT>    <a name="line.84"></a>
<FONT color="green">085</FONT>                    for (FeatureStructure fs : fsArray.toArray()) {<a name="line.85"></a>
<FONT color="green">086</FONT>                            list.add(cls.cast(fs));<a name="line.86"></a>
<FONT color="green">087</FONT>                    }<a name="line.87"></a>
<FONT color="green">088</FONT>                    return list;<a name="line.88"></a>
<FONT color="green">089</FONT>    <a name="line.89"></a>
<FONT color="green">090</FONT>            }<a name="line.90"></a>
<FONT color="green">091</FONT>    <a name="line.91"></a>
<FONT color="green">092</FONT>            public static Type getCasType(JCas jCas, Class&lt;? extends TOP&gt; cls) {<a name="line.92"></a>
<FONT color="green">093</FONT>                    try {<a name="line.93"></a>
<FONT color="green">094</FONT>                            return jCas.getCasType(cls.getField("type").getInt(null));<a name="line.94"></a>
<FONT color="green">095</FONT>                    }<a name="line.95"></a>
<FONT color="green">096</FONT>                    catch (IllegalAccessException e) {<a name="line.96"></a>
<FONT color="green">097</FONT>                            throw new IllegalArgumentException(e);<a name="line.97"></a>
<FONT color="green">098</FONT>                    }<a name="line.98"></a>
<FONT color="green">099</FONT>                    catch (NoSuchFieldException e) {<a name="line.99"></a>
<FONT color="green">100</FONT>                            throw new IllegalArgumentException(e);<a name="line.100"></a>
<FONT color="green">101</FONT>                    }<a name="line.101"></a>
<FONT color="green">102</FONT>            }<a name="line.102"></a>
<FONT color="green">103</FONT>    <a name="line.103"></a>
<FONT color="green">104</FONT>            public static String readSofa(JCas view) throws IOException {<a name="line.104"></a>
<FONT color="green">105</FONT>                    InputStream in = view.getSofaDataStream();<a name="line.105"></a>
<FONT color="green">106</FONT>                    StringBuffer tmp = new StringBuffer();<a name="line.106"></a>
<FONT color="green">107</FONT>                    byte[] b = new byte[4096];<a name="line.107"></a>
<FONT color="green">108</FONT>                    for (int n; (n = in.read(b)) != -1;) {<a name="line.108"></a>
<FONT color="green">109</FONT>                            tmp.append(new String(b, 0, n));<a name="line.109"></a>
<FONT color="green">110</FONT>                    }<a name="line.110"></a>
<FONT color="green">111</FONT>                    return tmp.toString();<a name="line.111"></a>
<FONT color="green">112</FONT>            }<a name="line.112"></a>
<FONT color="green">113</FONT>    <a name="line.113"></a>
<FONT color="green">114</FONT>            /**<a name="line.114"></a>
<FONT color="green">115</FONT>             * Get a configuration parameter value, raising an exception if it was not<a name="line.115"></a>
<FONT color="green">116</FONT>             * specified.<a name="line.116"></a>
<FONT color="green">117</FONT>             * <a name="line.117"></a>
<FONT color="green">118</FONT>             * @param context<a name="line.118"></a>
<FONT color="green">119</FONT>             *            The UIMAContext where the parameter should be defined.<a name="line.119"></a>
<FONT color="green">120</FONT>             * @param paramName<a name="line.120"></a>
<FONT color="green">121</FONT>             *            The name of the parameter.<a name="line.121"></a>
<FONT color="green">122</FONT>             * @return The value of the named parameter.<a name="line.122"></a>
<FONT color="green">123</FONT>             * @throws ResourceInitializationException<a name="line.123"></a>
<FONT color="green">124</FONT>             */<a name="line.124"></a>
<FONT color="green">125</FONT>            public static Object getRequiredConfigParameterValue(UimaContext context, String paramName)<a name="line.125"></a>
<FONT color="green">126</FONT>                            throws ResourceInitializationException {<a name="line.126"></a>
<FONT color="green">127</FONT>                    Object paramValue = context.getConfigParameterValue(paramName);<a name="line.127"></a>
<FONT color="green">128</FONT>                    if (paramValue == null) {<a name="line.128"></a>
<FONT color="green">129</FONT>                            String key = ResourceInitializationException.CONFIG_SETTING_ABSENT;<a name="line.129"></a>
<FONT color="green">130</FONT>                            throw new ResourceInitializationException(key, new Object[] { paramName });<a name="line.130"></a>
<FONT color="green">131</FONT>                    }<a name="line.131"></a>
<FONT color="green">132</FONT>                    else if (paramValue instanceof String) {<a name="line.132"></a>
<FONT color="green">133</FONT>                            String str = (String) paramValue;<a name="line.133"></a>
<FONT color="green">134</FONT>                            if (str.trim().equals("")) {<a name="line.134"></a>
<FONT color="green">135</FONT>                                    String key = ResourceInitializationException.CONFIG_SETTING_ABSENT;<a name="line.135"></a>
<FONT color="green">136</FONT>                                    throw new ResourceInitializationException(key, new Object[] { paramName });<a name="line.136"></a>
<FONT color="green">137</FONT>                            }<a name="line.137"></a>
<FONT color="green">138</FONT>                    }<a name="line.138"></a>
<FONT color="green">139</FONT>                    return paramValue;<a name="line.139"></a>
<FONT color="green">140</FONT>            }<a name="line.140"></a>
<FONT color="green">141</FONT>    <a name="line.141"></a>
<FONT color="green">142</FONT>            /**<a name="line.142"></a>
<FONT color="green">143</FONT>             * Get a configuration parameter value, supplying a default if it was not<a name="line.143"></a>
<FONT color="green">144</FONT>             * specified.<a name="line.144"></a>
<FONT color="green">145</FONT>             * <a name="line.145"></a>
<FONT color="green">146</FONT>             * @param context<a name="line.146"></a>
<FONT color="green">147</FONT>             *            The UIMAContext where the parameter should be defined.<a name="line.147"></a>
<FONT color="green">148</FONT>             * @param paramName<a name="line.148"></a>
<FONT color="green">149</FONT>             *            The name of the parameter.<a name="line.149"></a>
<FONT color="green">150</FONT>             * @param defaultValue<a name="line.150"></a>
<FONT color="green">151</FONT>             *            The value to use if the parameter was not specified.<a name="line.151"></a>
<FONT color="green">152</FONT>             * @return The value of the named parameter.<a name="line.152"></a>
<FONT color="green">153</FONT>             */<a name="line.153"></a>
<FONT color="green">154</FONT>            public static Object getDefaultingConfigParameterValue(UimaContext context, String paramName, Object defaultValue) {<a name="line.154"></a>
<FONT color="green">155</FONT>                    Object paramValue = context.getConfigParameterValue(paramName);<a name="line.155"></a>
<FONT color="green">156</FONT>                    if (paramValue == null) {<a name="line.156"></a>
<FONT color="green">157</FONT>                            paramValue = defaultValue;<a name="line.157"></a>
<FONT color="green">158</FONT>                    }<a name="line.158"></a>
<FONT color="green">159</FONT>                    else if (paramValue instanceof String) {<a name="line.159"></a>
<FONT color="green">160</FONT>                            String str = (String) paramValue;<a name="line.160"></a>
<FONT color="green">161</FONT>                            if (str.trim().equals("")) paramValue = defaultValue;<a name="line.161"></a>
<FONT color="green">162</FONT>                    }<a name="line.162"></a>
<FONT color="green">163</FONT>                    else if (paramValue instanceof String[]) {<a name="line.163"></a>
<FONT color="green">164</FONT>                            String[] strs = (String[]) paramValue;<a name="line.164"></a>
<FONT color="green">165</FONT>                            if (strs.length == 0) paramValue = defaultValue;<a name="line.165"></a>
<FONT color="green">166</FONT>                            if (strs.length == 1 &amp;&amp; strs[0].trim().equals("")) paramValue = defaultValue;<a name="line.166"></a>
<FONT color="green">167</FONT>                    }<a name="line.167"></a>
<FONT color="green">168</FONT>                    return paramValue;<a name="line.168"></a>
<FONT color="green">169</FONT>            }<a name="line.169"></a>
<FONT color="green">170</FONT>    <a name="line.170"></a>
<FONT color="green">171</FONT>            /**<a name="line.171"></a>
<FONT color="green">172</FONT>             * Create a JCas view from a CAS for a given view name.<a name="line.172"></a>
<FONT color="green">173</FONT>             * <a name="line.173"></a>
<FONT color="green">174</FONT>             * @param cas<a name="line.174"></a>
<FONT color="green">175</FONT>             *            The CAS object from which the JCas view should be derived.<a name="line.175"></a>
<FONT color="green">176</FONT>             * @param viewName<a name="line.176"></a>
<FONT color="green">177</FONT>             *            The name of the JCas view. If null, the default JCas view will<a name="line.177"></a>
<FONT color="green">178</FONT>             *            be returned instead. (No new view will be created.)<a name="line.178"></a>
<FONT color="green">179</FONT>             * @return The JCas view.<a name="line.179"></a>
<FONT color="green">180</FONT>             * @throws CollectionException<a name="line.180"></a>
<FONT color="green">181</FONT>             */<a name="line.181"></a>
<FONT color="green">182</FONT>            public static JCas createJCasView(CAS cas, String viewName) throws CollectionException {<a name="line.182"></a>
<FONT color="green">183</FONT>                    try {<a name="line.183"></a>
<FONT color="green">184</FONT>                            if (viewName == null || viewName.trim().equals("")) {<a name="line.184"></a>
<FONT color="green">185</FONT>                                    return cas.getJCas();<a name="line.185"></a>
<FONT color="green">186</FONT>                            }<a name="line.186"></a>
<FONT color="green">187</FONT>                            else {<a name="line.187"></a>
<FONT color="green">188</FONT>                                    return cas.createView(viewName).getJCas();<a name="line.188"></a>
<FONT color="green">189</FONT>                            }<a name="line.189"></a>
<FONT color="green">190</FONT>                    }<a name="line.190"></a>
<FONT color="green">191</FONT>                    catch (CASException e) {<a name="line.191"></a>
<FONT color="green">192</FONT>                            throw new CollectionException(e);<a name="line.192"></a>
<FONT color="green">193</FONT>                    }<a name="line.193"></a>
<FONT color="green">194</FONT>            }<a name="line.194"></a>
<FONT color="green">195</FONT>    <a name="line.195"></a>
<FONT color="green">196</FONT>            /**<a name="line.196"></a>
<FONT color="green">197</FONT>             * Take the name of a Java class from the UimaContext, instantiate the<a name="line.197"></a>
<FONT color="green">198</FONT>             * class, and initialize it (if possible).<a name="line.198"></a>
<FONT color="green">199</FONT>             * &lt;p&gt;<a name="line.199"></a>
<FONT color="green">200</FONT>             * This method was enhanced to handle instantiation of declared (member)<a name="line.200"></a>
<FONT color="green">201</FONT>             * classes so that e.g. one could instantiate an annotation handler defined<a name="line.201"></a>
<FONT color="green">202</FONT>             * as a member class in a unit test using the<a name="line.202"></a>
<FONT color="green">203</FONT>             * InstanceConsumer_ImplBase.initialize method. While this is quite<a name="line.203"></a>
<FONT color="green">204</FONT>             * convenient, make note that the referring to MyUnitTest.this in your unit<a name="line.204"></a>
<FONT color="green">205</FONT>             * test code will not work correctly in that inner class that is the test<a name="line.205"></a>
<FONT color="green">206</FONT>             * annotation handler because an instance of your unit test will be created<a name="line.206"></a>
<FONT color="green">207</FONT>             * by JUnit to run the test and another instance will be created in this<a name="line.207"></a>
<FONT color="green">208</FONT>             * method. The latter is what is available inside your inner class and is,<a name="line.208"></a>
<FONT color="green">209</FONT>             * in general, not the "this" that you want.<a name="line.209"></a>
<FONT color="green">210</FONT>             * <a name="line.210"></a>
<FONT color="green">211</FONT>             * @param &lt;T&gt;<a name="line.211"></a>
<FONT color="green">212</FONT>             *            The supertype of the class which should be instantiated.<a name="line.212"></a>
<FONT color="green">213</FONT>             * @param context<a name="line.213"></a>
<FONT color="green">214</FONT>             *            The UimaContext from which the parameter should be read.<a name="line.214"></a>
<FONT color="green">215</FONT>             * @param classParamName<a name="line.215"></a>
<FONT color="green">216</FONT>             *            The name of the the UimaContext parameter containing the class<a name="line.216"></a>
<FONT color="green">217</FONT>             *            name.<a name="line.217"></a>
<FONT color="green">218</FONT>             * @param superClass<a name="line.218"></a>
<FONT color="green">219</FONT>             *            The superclass of the class which should be instantiated.<a name="line.219"></a>
<FONT color="green">220</FONT>             * @return An instance of the requested class, as a subtype of the supplied<a name="line.220"></a>
<FONT color="green">221</FONT>             *         superclass. The instance's initialize method will be called if<a name="line.221"></a>
<FONT color="green">222</FONT>             *         possible, using {@link #initialize(Object, UimaContext)}<a name="line.222"></a>
<FONT color="green">223</FONT>             * @throws ResourceInitializationException<a name="line.223"></a>
<FONT color="green">224</FONT>             */<a name="line.224"></a>
<FONT color="green">225</FONT>            public static &lt;T&gt; T create(UimaContext context, String classParamName, Class&lt;T&gt; superClass)<a name="line.225"></a>
<FONT color="green">226</FONT>                            throws ResourceInitializationException {<a name="line.226"></a>
<FONT color="green">227</FONT>    <a name="line.227"></a>
<FONT color="green">228</FONT>                    Class&lt;? extends T&gt; cls = getClass(context, classParamName, superClass);<a name="line.228"></a>
<FONT color="green">229</FONT>    <a name="line.229"></a>
<FONT color="green">230</FONT>                    // create a new instance<a name="line.230"></a>
<FONT color="green">231</FONT>                    T instance;<a name="line.231"></a>
<FONT color="green">232</FONT>                    try {<a name="line.232"></a>
<FONT color="green">233</FONT>                            if (cls.isMemberClass() &amp;&amp; (cls.getModifiers() &amp; Modifier.STATIC) == 0) {<a name="line.233"></a>
<FONT color="green">234</FONT>                                    Class&lt;?&gt; declaringClass = cls.getDeclaringClass();<a name="line.234"></a>
<FONT color="green">235</FONT>                                    Object declaringInstance = declaringClass.newInstance();<a name="line.235"></a>
<FONT color="green">236</FONT>                                    instance = cls.getConstructor(new Class[] { declaringInstance.getClass() }).newInstance(<a name="line.236"></a>
<FONT color="green">237</FONT>                                                    new Object[] { declaringInstance });<a name="line.237"></a>
<FONT color="green">238</FONT>                            }<a name="line.238"></a>
<FONT color="green">239</FONT>                            else {<a name="line.239"></a>
<FONT color="green">240</FONT>                                    instance = cls.newInstance();<a name="line.240"></a>
<FONT color="green">241</FONT>                            }<a name="line.241"></a>
<FONT color="green">242</FONT>                    }<a name="line.242"></a>
<FONT color="green">243</FONT>                    catch (Exception e) {<a name="line.243"></a>
<FONT color="green">244</FONT>                            throw new ResourceInitializationException(e);<a name="line.244"></a>
<FONT color="green">245</FONT>                    }<a name="line.245"></a>
<FONT color="green">246</FONT>    <a name="line.246"></a>
<FONT color="green">247</FONT>                    // initialize and return the SequentialAnnotationHandler<a name="line.247"></a>
<FONT color="green">248</FONT>                    UIMAUtil.initialize(instance, context);<a name="line.248"></a>
<FONT color="green">249</FONT>                    return instance;<a name="line.249"></a>
<FONT color="green">250</FONT>            }<a name="line.250"></a>
<FONT color="green">251</FONT>    <a name="line.251"></a>
<FONT color="green">252</FONT>            public static &lt;T&gt; Class&lt;? extends T&gt; getClass(UimaContext context, String classParamName, Class&lt;T&gt; superClass)<a name="line.252"></a>
<FONT color="green">253</FONT>                            throws ResourceInitializationException {<a name="line.253"></a>
<FONT color="green">254</FONT>                    // get the class name from the parameter<a name="line.254"></a>
<FONT color="green">255</FONT>                    Object className = getRequiredConfigParameterValue(context, classParamName);<a name="line.255"></a>
<FONT color="green">256</FONT>    <a name="line.256"></a>
<FONT color="green">257</FONT>                    try {<a name="line.257"></a>
<FONT color="green">258</FONT>                            Class&lt;? extends T&gt; cls = Class.forName((String) className).asSubclass(superClass);<a name="line.258"></a>
<FONT color="green">259</FONT>                            return cls;<a name="line.259"></a>
<FONT color="green">260</FONT>                    }<a name="line.260"></a>
<FONT color="green">261</FONT>                    catch (Exception e) {<a name="line.261"></a>
<FONT color="green">262</FONT>                            throw new ResourceInitializationException(e);<a name="line.262"></a>
<FONT color="green">263</FONT>                    }<a name="line.263"></a>
<FONT color="green">264</FONT>    <a name="line.264"></a>
<FONT color="green">265</FONT>            }<a name="line.265"></a>
<FONT color="green">266</FONT>    <a name="line.266"></a>
<FONT color="green">267</FONT>            /**<a name="line.267"></a>
<FONT color="green">268</FONT>             * Initialize the object using the UimaContext, if possible.<a name="line.268"></a>
<FONT color="green">269</FONT>             * <a name="line.269"></a>
<FONT color="green">270</FONT>             * In particular, the current implementation will initialize any object<a name="line.270"></a>
<FONT color="green">271</FONT>             * which is either an Initializable instance or an AnalysisComponent<a name="line.271"></a>
<FONT color="green">272</FONT>             * instance.<a name="line.272"></a>
<FONT color="green">273</FONT>             * <a name="line.273"></a>
<FONT color="green">274</FONT>             * @param object<a name="line.274"></a>
<FONT color="green">275</FONT>             *            The object to be initialized.<a name="line.275"></a>
<FONT color="green">276</FONT>             * @param context<a name="line.276"></a>
<FONT color="green">277</FONT>             *            The UimaContext used to initialize the object<a name="line.277"></a>
<FONT color="green">278</FONT>             * @throws ResourceInitializationException<a name="line.278"></a>
<FONT color="green">279</FONT>             */<a name="line.279"></a>
<FONT color="green">280</FONT>            public static void initialize(Object object, UimaContext context) throws ResourceInitializationException {<a name="line.280"></a>
<FONT color="green">281</FONT>                    if (object instanceof Initializable) {<a name="line.281"></a>
<FONT color="green">282</FONT>                            ((Initializable) object).initialize(context);<a name="line.282"></a>
<FONT color="green">283</FONT>                    }<a name="line.283"></a>
<FONT color="green">284</FONT>            }<a name="line.284"></a>
<FONT color="green">285</FONT>    <a name="line.285"></a>
<FONT color="green">286</FONT>            /**<a name="line.286"></a>
<FONT color="green">287</FONT>             * Checks that the given type parameters of the given objects are compatible.<a name="line.287"></a>
<FONT color="green">288</FONT>             * <a name="line.288"></a>
<FONT color="green">289</FONT>             * Type parameters are identified by providing the class in which the type<a name="line.289"></a>
<FONT color="green">290</FONT>             * parameter is defined, and the declared name of the type parameter.<a name="line.290"></a>
<FONT color="green">291</FONT>             * <a name="line.291"></a>
<FONT color="green">292</FONT>             * Throws a ResourceInitializationException if the type parameters are not<a name="line.292"></a>
<FONT color="green">293</FONT>             * compatible.<a name="line.293"></a>
<FONT color="green">294</FONT>             * <a name="line.294"></a>
<FONT color="green">295</FONT>             * @param &lt;T&gt; Type of the class declaring the first type parameter<a name="line.295"></a>
<FONT color="green">296</FONT>             * @param &lt;U&gt; Type of the class declaring the second type parameter<a name="line.296"></a>
<FONT color="green">297</FONT>             * @param paramDefiningClass1 The class declaring the first type parameter<a name="line.297"></a>
<FONT color="green">298</FONT>             * @param paramName1          The declared name of the first type parameter<a name="line.298"></a>
<FONT color="green">299</FONT>             * @param object1             The target object<a name="line.299"></a>
<FONT color="green">300</FONT>             * @param paramDefiningClass2 The class declaring the second type parameter<a name="line.300"></a>
<FONT color="green">301</FONT>             * @param paramName2          The declared name of the second type parameter<a name="line.301"></a>
<FONT color="green">302</FONT>             * @param object2             The source object<a name="line.302"></a>
<FONT color="green">303</FONT>             * @throws ResourceInitializationException <a name="line.303"></a>
<FONT color="green">304</FONT>             */<a name="line.304"></a>
<FONT color="green">305</FONT>            public static &lt;T, U&gt; void checkTypeParameterIsAssignable(<a name="line.305"></a>
<FONT color="green">306</FONT>                            Class&lt;T&gt; paramDefiningClass1, String paramName1, T object1,<a name="line.306"></a>
<FONT color="green">307</FONT>                            Class&lt;U&gt; paramDefiningClass2, String paramName2, U object2)<a name="line.307"></a>
<FONT color="green">308</FONT>            throws ResourceInitializationException {<a name="line.308"></a>
<FONT color="green">309</FONT>                    <a name="line.309"></a>
<FONT color="green">310</FONT>                    // get the type arguments from the objects<a name="line.310"></a>
<FONT color="green">311</FONT>                    java.lang.reflect.Type type1 = ReflectionUtil.getTypeArgument(<a name="line.311"></a>
<FONT color="green">312</FONT>                                    paramDefiningClass1, paramName1, object1);<a name="line.312"></a>
<FONT color="green">313</FONT>                    java.lang.reflect.Type type2 = ReflectionUtil.getTypeArgument(<a name="line.313"></a>
<FONT color="green">314</FONT>                                    paramDefiningClass2, paramName2, object2);<a name="line.314"></a>
<FONT color="green">315</FONT>                    <a name="line.315"></a>
<FONT color="green">316</FONT>                    // if the second type is not assignable to the first, raise an exception<a name="line.316"></a>
<FONT color="green">317</FONT>                    if (type1 == null || type2 == null || !ReflectionUtil.isAssignableFrom(type1, type2)) {<a name="line.317"></a>
<FONT color="green">318</FONT>                            throw new ResourceInitializationException(new RuntimeException(String.format(<a name="line.318"></a>
<FONT color="green">319</FONT>                                            "%s with %s %s is incompatible with %s with %s %s",<a name="line.319"></a>
<FONT color="green">320</FONT>                                            object1.getClass().getSimpleName(), paramName1, type1,<a name="line.320"></a>
<FONT color="green">321</FONT>                                            object2.getClass().getSimpleName(), paramName2, type2)));<a name="line.321"></a>
<FONT color="green">322</FONT>                    }<a name="line.322"></a>
<FONT color="green">323</FONT>            }<a name="line.323"></a>
<FONT color="green">324</FONT>    <a name="line.324"></a>
<FONT color="green">325</FONT>            /**<a name="line.325"></a>
<FONT color="green">326</FONT>             * Run the CollectionReader and AnalysisEngines as a pipeline.<a name="line.326"></a>
<FONT color="green">327</FONT>             * <a name="line.327"></a>
<FONT color="green">328</FONT>             * @param reader   The CollectionReader that loads the documents into the CAS.<a name="line.328"></a>
<FONT color="green">329</FONT>             * @param descs  The AnalysisEngines that process the CAS, in order.<a name="line.329"></a>
<FONT color="green">330</FONT>             */<a name="line.330"></a>
<FONT color="green">331</FONT>            public static void runUIMAPipeline(CollectionReader reader, AnalysisEngineDescription ... descs)<a name="line.331"></a>
<FONT color="green">332</FONT>            throws UIMAException, IOException {<a name="line.332"></a>
<FONT color="green">333</FONT>                    AnalysisEngine[] engines = new AnalysisEngine[descs.length];<a name="line.333"></a>
<FONT color="green">334</FONT>                    for (int i = 0; i &lt; engines.length; ++i) {<a name="line.334"></a>
<FONT color="green">335</FONT>                            engines[i] = AnalysisEngineFactory.createPrimitiveAnalysisEngine(descs[i]);<a name="line.335"></a>
<FONT color="green">336</FONT>                    }<a name="line.336"></a>
<FONT color="green">337</FONT>                    runUIMAPipeline(reader, engines);<a name="line.337"></a>
<FONT color="green">338</FONT>            }<a name="line.338"></a>
<FONT color="green">339</FONT>    <a name="line.339"></a>
<FONT color="green">340</FONT>            public static void runUIMAPipeline(CollectionReader reader, AnalysisEngine... engines)<a name="line.340"></a>
<FONT color="green">341</FONT>            throws UIMAException, IOException {<a name="line.341"></a>
<FONT color="green">342</FONT>                    for (JCas jCas: new JCasIterable(reader, engines)) {<a name="line.342"></a>
<FONT color="green">343</FONT>                            assert jCas != null;<a name="line.343"></a>
<FONT color="green">344</FONT>                    }<a name="line.344"></a>
<FONT color="green">345</FONT>                    for (AnalysisEngine engine: engines) {<a name="line.345"></a>
<FONT color="green">346</FONT>                            engine.collectionProcessComplete();<a name="line.346"></a>
<FONT color="green">347</FONT>                    }<a name="line.347"></a>
<FONT color="green">348</FONT>                    reader.close();<a name="line.348"></a>
<FONT color="green">349</FONT>            }<a name="line.349"></a>
<FONT color="green">350</FONT>    <a name="line.350"></a>
<FONT color="green">351</FONT>    }<a name="line.351"></a>




























































</PRE>
</BODY>
</HTML>
